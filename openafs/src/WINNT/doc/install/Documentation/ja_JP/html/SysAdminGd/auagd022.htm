<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理の手引き</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- E:\IDWB\TEMP\idwt2118\AUAGD000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 12:07:32            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 12:07:30">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 12:07:30">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 12:07:30">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    -->
<BODY bgcolor="ffffff">
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理の手引き</H1>
<P>
<HR><H1><A NAME="HDRWQ818" HREF="auagd002.htm#ToC_666">付録 A. NFS/AFS 変換プログラムの管理</A></H1>
<A NAME="IDX8157"></A>
<A NAME="IDX8158"></A>
<P>NFS<SUP><SUP>(R)</SUP></SUP>/AFS<SUP><SUP>(R)</SUP></SUP> 変換プログラムを使用すると、
NFS クライアント・マシンで作業するユーザーが、
AFS に保管されるファイルへのアクセス、ファイルの作成および除去を行うことができます。この章では、
NFS と AFS の両方に精通していることを想定しています。
<HR><H2><A NAME="HDRWQ819" HREF="auagd002.htm#ToC_667">説明の要約</A></H2>
<P>本章では、指示されたコマンドを使用した以下のタスクの実行方法を説明します。
<BR>
<TABLE WIDTH="100%">
<TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">ディレクトリーを変換プログラム・マシンに取り付ける
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>mount</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%"><B>@sys</B> の値を検査する
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>fs sysname</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">AFS の再エクスポートを使用可 / 使用不可、その他のパラメーターを設定
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>fs exportafs</B>
</TD></TR><TR>
<TD ALIGN="LEFT" VALIGN="TOP" WIDTH="70%">NFS クライアント・マシンのユーザーに AFS トークンを割り当てる
</TD><TD ALIGN="LEFT" VALIGN="TOP" WIDTH="30%"><B>knfs</B>
</TD></TR></TABLE>
<HR><H2><A NAME="HDRWQ824" HREF="auagd002.htm#ToC_668">概説</A></H2>
<P>NFS/AFS 変換プログラムを使用すると、NFS クライアント・マシン上のユーザーは、
AFS クライアント・マシンで作業しているかのように AFS のファイル・スペースにアクセスすることができ、他の AFS ユーザーとの協力が容易になります。
<P><I>NFS/AFS 変換プログラム・マシン</I> (または単に <I>変換プログラム・マシン</I>) は、
AFS クライアントと NFS サーバーの両方として構成されたマシンです。
<UL>
<LI>AFS クライアント機能によって、マシンは AFS のファイル・スペースにアクセスすることができます。キャッシュ・マネージャーは、AFS ファイル・サーバー・マシンからファイルを要求してキャッシュし、ユーザーが AFS を使用して認証を行えるよう構成を変更した場合は、NFS ユーザーのトークンを保守します。
</LI><LI>その NFS サーバーの機能性によって、変換プログラム・マシンが AFS ファイル・スペースを NFS クライアント・マシンにエクスポートすることができます。NFS クライアント・マシンのユーザーが、変換プログラム・マシンの <B>/afs</B> ディレクトリーを取り付けるとき (またはその機能が使用できる場合は、サブディレクトリーの 1 つ)、
AFS へのアクセスは即時に透過的に行われます。NFS クライアント・マシンは、AFS ソフトウェアをどれも実行する必要もありません。
</LI></UL>
<P><H3><A NAME="HDRWQ825" HREF="auagd002.htm#ToC_669">非認証または認証済みの AFS アクセスを使用可能にする</A></H3>
<P>変換環境を適切に構成することにより、
NFS クライアント・マシンから AFS への非認証または認証済みアクセスを許可することができます。変換マシン、NFS クライアント・マシン、および AFS ユーザー・アカウントの構成に関するこの章のこの機能グループでは、変換環境の適切な構成方法について説明します。
<UL>
<LI>非認証アクセスのための環境を構成する場合、AFS ファイル・サーバーでは、
NFS ユーザーを <B>anonymous</B> ユーザーとみなします。
anonymous ユーザーは、アクセス制御リスト (ACL) が
<B>system:anyuser</B> グループに対して必要な許可を拡大した AFS ファイルとディレクトリーだけにアクセスすることができます。
anonymous ユーザーは、特権を必要としない AFS コマンドだけを発行できます。しかも発行できるのは NFS クライアント・マシンで AFS バイナリーが使用可能であり <B>system:anyuser</B> グループによるアクセスが可能な場合だけです。このようなユーザーには、AFS アカウントはありません。
</LI><LI>認証済みアクセスのための環境を構成する場合は、
NFS ユーザーに AFS 認証および保護データベースの項目を作成する必要があります。使用する認証の手順は、
NFS クライアント・マシンが、サポートされるシステム・タイプ (AFS バイナリーが使用可能なシステム・タイプ) であるかどうかによって異なります。
<UL>
<LI>NFS クライアント・マシンで AFS バイナリーが使用可能な場合、
NFS ユーザーは、NFS クライアント・マシンで <B>klog</B> コマンドを発行できます。ユーザーは、ファイル・スペースにアクセスし、
AFS クライアント・マシンで作業する認証済みユーザーと同じエクステントに AFS コマンドを発行することができます。
</LI><LI>AFS バイナリーを NFS クライアント・マシンに対して使用できない場合、
NFS ユーザーは、変換プログラム・マシンとの接続を確立し (たとえば、<B>telnet</B> ユーティリティーを使って)、その後、変換プログラムで <B>klog</B> コマンドと <B>knfs</B> コマンドを発行して、
NFS クライアントで作業する間は、そのキャッシュ・マネージャーに正しいトークンを使用させます。ユーザーは認証済みユーザーとして AFS ファイル・スペースにアクセスできますが、
AFS コマンドを発行することはできません。説明については、<A HREF="#HDRWQ838">非サポート NFS クライアント・マシンでの認証</A>を参照してください。
</LI></UL>
</LI></UL>
<P><H3><A NAME="HDRWQ826" HREF="auagd002.htm#ToC_670">AFSSERVER および AFSCONF 環境変数の設定</A></H3>
<P>NFS ユーザーを使用可能にして AFS コマンドを発行するには、そのコマンド・シェルで AFSSERVER および AFSCONF 環境変数を定義する必要があります。このセクションでは、変数の機能について説明し、その各種設定方法の概要を示します。
<P>AFS コマンドを発行するには、NFS クライアント・マシンが、サポートされるシステム・タイプ (AFS バイナリーが使用可能なシステム・タイプ) である必要もあります。サポートされないシステム・タイプの NFS クライアント・マシン上で作業をするユーザーは、認証ユーザーとして AFS にアクセスできますが、AFS コマンドを発行することはできません。このようなユーザーには、
AFSSERVER および AFSCONF 変数を定義する必要はありません。
<B>knfs</B> コマンドを使用して、非サポートのシステム・タイプへの認証アクセスを取得する方法については、
<A HREF="#HDRWQ838">非サポート NFS クライアント・マシンでの認証</A> を参照してください。
<A NAME="IDX8159"></A>
<P><H4><A NAME="HDRWQ827">AFSSERVER 変数</A></H4>
<P>AFSSERVER 変数は、
NFS クライアントの 2 つの機能を実行する AFS クライアント・マシンを指定します。
<UL>
<LI>NFS クライアントに代わって AFS 固有のシステム呼び出しを実行することにより <I>リモート実行プログラム</I> として機能します
(<B>klog</B> および <B>tokens</B> コマンド、および多くの AFS 組コマンドにより呼び出されるシステム呼び出しなど)。
</LI><LI>NFS ユーザーが AFS で認証を行う際に取得するトークンを保管します。これには、ユーザーが AFS への認証アクセスを必要とする場合、リモート実行プログラム・マシンと変換プログラム・マシンが同じマシンにあることが暗黙指定されます。
</LI></UL>
<P>リモート実行プログラムの選択は、キャッシュ・マネージャーの構成を表示または変更するコマンド (<B>fs getcacheparms</B>、
<B>fs getcellstatus</B>、および <B>fs setcell</B> コマンドなど) に最も直接に影響します。
NFS クライアントでこれらのコマンドが発行されると、指定されたリモート実行プログラム・マシンにあるキャッシュ・マネージャーに影響を及ぼします。(ただし、このようなコマンドでは、発行者は、リモート実行プログラムのローカル・ファイルにローカル・スーパーユーザー <B>root</B> としてログインする必要のあるものがあります。
NFS クライアント・ユーザーの、<B>root</B> としてログインする機能は、
NFS/AFS 変換プログラムではなく、NFS が制御します。したがって、リモート実行プログラムを適切に構成するだけでは、
NFS クライアント・ユーザーはこのようなコマンドを発行することはできません。)
<P>リモート実行プログラムの選択はまた、キャッシュ・マネージャー構成に関係のない AFS コマンドにも関係しますが、いずれのマシンにも同様の結果をもたらします (ACL およびボリューム割り当て量を表示または設定する <B>fs</B> コマンドなど)
これらのコマンドは、その引き数に AFS パスを取ります。リモート実行プログラム・マシン上のキャッシュ・マネージャーが、通常 AFS クライアントに行うように <B>/afs</B> ディレクトリーに AFS ファイル・スペースを取り付ける場合、
NFS クライアントに指定されたパス名を文字列 <B>/afs</B> で開始し、キャッシュ・マネージャーがこれを解釈できるようにする必要があります。これには、リモート実行プログラムが、
NFS クライアントの 1 次変換プログラム・マシン (その <B>/afs</B> ディレクトリーが NFS クライアントの <B>/afs</B> に取り付けられているマシン) であることが暗黙指定となります。
<A NAME="IDX8160"></A>
<A NAME="IDX8161"></A>
<P><H4><A NAME="Header_672">AFSCONF 変数</A></H4>
<P>AFSCONF 環境変数は、
NFS クライアント・マシンで発行された AFS コマンドを実行する際に使用する <B>ThisCell</B> および <B>CellServDB</B> ファイルを格納するディレクトリーの名前を付けます。
AFS クライアントの場合のように、これらのファイルによって、コマンドを実行するためのデフォルトのセルが決められます。
<P>予測しうるパフォーマンスを得るためには、
AFSCONF 環境変数により名前を付けたディレクトリーにあるファイルは、変換プログラム・マシンの <B>/usr/vice/etc</B> ディレクトリーにあるファイルと同じであることが最適です。
<B>/usr/vice/etc</B> ディレクトリーにあるファイルの中央更新ソースとしての機能を果たす AFS ディレクトリーがユーザーのセルにある場合には、
AFSCONF 変数を設定してこれを参照するのが最も簡単な方法です。標準構成では、このディレクトリーは
<B>/afs/</B><VAR>cellname</VAR><B>/common/etc</B> と呼ばれます。
<P><H4><A NAME="Header_673">変数の値の設定</A></H4>
<P>AFSSERVER および AFSCONF 変数の値を識別するため、
AFS コマンド・インタープリターは、以下の 3 つのソースを順に参照します。
<OL TYPE=1>
<LI>現行のコマンド・シェルの環境変数定義
</LI><LI>発行もとのホーム・ディレクトリーにある <B>.AFSSERVER</B> または <B>.AFSCONF</B> ファイル
</LI><LI>NFS クライアント・マシンのルート (root)
(<I>/</I>) ディレクトリーにある <B>/.AFSSERVER</B> ファイルまたは <B>/.AFSCONF</B> ファイル・クライアント・マシンがディスクレスである場合は、そのルート・ディレクトリーは、NFS サーバー・マシン上に常駐できます。
</LI></OL>
<P>(実際に、これらのソースを参照する前に、
NFS クライアントは自らの <B>/usr/vice/etc</B> ディレクトリーで <B>CellServDB</B> と <B>ThisCell</B> ファイルを探します。ディレクトリーが存在する場合、NFS クライアントは AFSCONF 変数の値を使用しません。ただし、<B>/usr/vice/etc</B> ディレクトリーは通常 AFS クライアントにのみ存在し、
NFS クライアントには存在しません。)
<P>先の説明のとおり、適切なパフォーマンスを得るには、一般的にリモート実行プログラムが NFS クライアントの 1 次変換プログラム・マシン (その <B>/afs</B> ディレクトリーが NFS クライアントの <B>/afs</B> ディレクトリーに取り付けられているマシン) である必要があります。この要件は、NFS クライアントから AFS にアクセスするすべてのユーザーに適用されるため、通常は NFS クライアントのルート・ディレクトリーに <B>.AFSSERVER</B> ファイルを作成するのが最も簡単な方法です。ユーザーのホーム・ディレクトリーにファイルを作成する、または現行のコマンド・シェルに AFSSERVER 環境変数を設定する主な理由としては、ユーザーが、オリジナルの変換プログラム・マシンにアクセスできなくなった場合に、別のマシンに切り換える必要のある場合があります。
<P>同じく、一般的に、<B>.AFSCONF</B> ファイルを NFS クライアントのルート・ディレクトリーに作成するのは意味のあることです。ファイルをユーザーのホーム・ディレクトリーに作成する、または現行コマンド・シェルに AFSCONF 環境変数を設定することは、たとえばテスト状況などで、セルに異なるセットのデータベース・サーバー・マシンを指定する場合に最も役に立ちます。
<P><H3><A NAME="HDRWQ828" HREF="auagd002.htm#ToC_674">NFS クライアント・マシンに保管されるファイルの遅延書き込み</A></H3>
<A NAME="IDX8162"></A>
<A NAME="IDX8163"></A>
<A NAME="IDX8164"></A>
<A NAME="IDX8165"></A>
<A NAME="IDX8166"></A>
<A NAME="IDX8167"></A>
<A NAME="IDX8168"></A>
<P>AFS クライアント・マシンで実行されるアプリケーションがファイルに <B>close</B> または <B>fsync</B> システム呼び出しを行う場合、キャッシュ・マネージャーはデフォルトでファイル・サーバーへのデータの同期書き込みをします。
(詳細については、<A HREF="auagd007.htm#HDRWQ34">AFS がインプリメントするクローズ時の保管</A> および <A HREF="auagd015.htm#HDRWQ565">非同期書き込みを使用可能にする</A> を参照してください。)
<P>変換プログラム・マシンで作業中のユーザーに対してパフォーマンスを低下させることのないよう、
AFS は 変換プログラム・マシンの NFS クライアント上で実行されているアプリケーションに対しては同期書き込みを行いません。代わりに、キャッシュ・マネージャー・デーモン (<I>保守デーモン</I>) が、
NFS クライアントに保管されたデータを含むキャッシュのチャンクを 60 秒ごとにチェックし、その内容をファイル・サーバーに書き込みます。これは、
NFS クライアントに保管されたデータが 60 秒以内にファイル・サーバーに書き込まれることを保証するものではなく、保守デーモンがチェックを行い、この間隔でデータの書き込みを開始するだけです。
<P>さらに AFS は、NFS クライアントで発行された <B>fsync</B> システムを常に無視します。呼び出しは、ファイル・サーバーから即時に、おそらくは時間のかかる応答を要求し、これによりファイル・サーバーの他の AFS クライアントの遅延を生じさせる可能性があります。
NFS バージョン 3 は、
<B>close</B> 呼び出しの直後に自動的に <B>fsync</B> システム呼び出しを発行しますが、キャッシュ・マネージャーはこれを無視し、通常の <B>close</B> と同様に操作します。
<P>遅延書き込み機構は、NFS アプリケーションがファイルに <B>close</B> または <B>fsync</B> システム呼び出しを発行する時間と、ファイル・サーバーに変更が記録される、つまり他の AFS クライアント・マシンで作業中のユーザーに対して (直接にまたは NFS クライアント上に) 表示される時間との間に、通常は遅延が生じることを意味します。遅延時間は、AFS クライアント・マシンで直接に作業をしているユーザーがファイルを保管する場合よりも、長くなります。
<P>正確な遅延時間は、予測が困難です。NFS プロトコルそのものにおいては、保存したデータが NFS クライアントから NFS サーバー (変換プログラム・マシン) に転送される前に、標準的な遅延が可能です。変更されたデータは、保守デーモンが予定している次回のデータ・チェックまで変換プログラム・マシンの AFS クライアント・キャッシュにとどまり、データをファイル・サーバーに転送するには、余分な時間がかかります。保守デーモンは単一スレッドを使用するため、変更されたすべての NFS データの書き出し時間が 60 秒を超えると、追加して遅延が発生する場合があります。つまり、次回に予定されているチェック時に保守デーモンがデータの書き込みを行っている場合、その長時間の書き込み操作が完了した後の予定時刻までは、追加の変更データの通知はできません。
<P><B>write</B> システム呼び出しに対するキャッシュ・マネージャーの応答は、呼び出しが AFS クライアント・マシンで行われた場合でも、変換プログラム・マシンの NFS クライアントで行われた場合でも同じです。変更は、ローカルの AFS クライアント・キャッシュにのみ記録されます。
<HR><H2><A NAME="HDRWQ829" HREF="auagd002.htm#ToC_675">NFS/AFS 変換プログラム・マシン</A></H2>
<P>NFS/AFS 変換プログラム・マシンとして動作するためには、マシンに以下の構成が必要です。
<UL>
<LI>AFS クライアントである必要があります。
AFS クライアントとしてサポートされる多くのシステム・タイプは、変換プログラム・マシンとなることができます。AFS の特定のリリースに可能な制約事項について確認するには、
<I>AFS Release Notes</I> を参照してください。
</LI><LI>NFS サーバーである必要があります。NFS サーバー・デーモン (<B>nfsd</B> およびその他) の適切な数は、予想される NFS クライアントの負荷によって異なります。
</LI><LI>AFS ファイル・スペースが取り付けられるローカル・ディレクトリー (通常 <B>/afs</B>) をエクスポートする必要があります。
</LI></UL>
<P>変換プログラム・マシンの NFS クライアント上のユーザーが AFS コマンドを発行する場合、変換プログラム・マシンは、<A HREF="#HDRRMTSYS">AFS コマンドを受け入れるための変換プログラム・マシンの構成</A> にある要件も満たす必要があります。
<P><H3><A NAME="Header_676" HREF="auagd002.htm#ToC_676">NFS および AFS カーネル拡張のロード</A></H3>
<P>NFS/AFS 変換プログラム・マシンとして動作するシステム・タイプに配布される AFS には、
2 つのバージョンの AFS カーネル拡張ファイルが含まれます。
1 つはカーネルが NFS サーバー機能をサポートするマシン用で、もう 1 つは NFS を使用しないマシン用です (後者の AFS カーネル拡張ファイルの名前には通常、文字列 <B>nonfs</B> が含まれています)。変換プログラム・マシンは、
NFS 使用可能バージョンの AFS 拡張ファイルを使用しなくてはなりません。システム・タイプによっては、ファイルを特定の位置に移動して適当なものを選択したり、変数を設定して適当なファイルを自動的に選択する場合があります。各システム・タイプにおける AFS のカーネルへの組み込みについては、
<I>AFS インストールの手引き</I> の説明を参照してください。
<P>多くのシステム・タイプでは、NFS はデフォルトでカーネルに組み込まれているため、明示的に NFS カーネル拡張をロードする必要はありません。
NFS カーネル拡張をロードする必要のあるシステム・タイプの場合、一般的に AFS カーネル拡張をロードする前に NFS カーネル拡張をロードする必要があります。
<I>AFS インストールの手引き</I> には、マシンの始動シーケンスに AFS 初期化スクリプトを組み込み、
NFS を処理するスクリプトを反映して正しい順序にするための方法が説明されています。
<P>またカーネルへの AFS 拡張のロードは、<B>afsd</B> コマンドを実行する前に行う必要があります。
AFS の配布に含まれる AFS 初期化スクリプトには、ロードと <B>afsd</B> コマンドが正しく配列されています。
<P><H3><A NAME="HDRRMTSYS" HREF="auagd002.htm#ToC_677">AFS コマンドを受け入れるための変換プログラム・マシンの構成</A></H3>
<P>変換プログラム・マシンの NFS クライアントで作業中のユーザーが AFS コマンドを発行するには、変換プログラム・マシンのキャッシュ・マネージャーを初期化する <B>afsd</B> コマンドに <B>-rmtsys</B> フラグを組み込む必要があります。フラグにより追加デーモン (<I>リモート実行プログラム・デーモン</I>) が開始し、
NFS に代わり AFS 固有のシステム呼び出しが実行されます。
NFS ユーザーが AFS コマンドを発行するための暗黙指定についての説明は、<A HREF="#HDRWQ826">AFSSERVER および AFSCONF 環境変数の設定</A> を参照してください。
<P><I>AFS インストールの手引き</I> でのキャッシュ・マネージャーの構成では、
AFS 初期化スクリプトの <B>afsd</B> コマンドへの <B>-rmtsys</B> フラグなどのオプションの追加について説明しています。多くのシステム・タイプでは、スクリプト内の OPTIONS 変数の定義行にフラグをリストするのが最も簡単な方法です。リモート実行プログラム・デーモンは多くのリソースを消費しないので、マシンの NFS クライアントのすべてのユーザーが AFS コマンドを発行するのではない場合でも、各変換プログラム・マシンに <B>afsd</B> コマンドを追加するのが最も単純です。
<P><H3><A NAME="HDRWQ830" HREF="auagd002.htm#ToC_678">オプションの変換プログラム機能の制御</A></H3>
<P>AFS クライアント・マシンを変換プログラム・マシンとして構成すると、これはデフォルトで AFS ファイル・スペースを NFS クライアントにエクスポートします。変換プログラム機能を使用不可または再度使用可能にするには、
<B>fs exportafs</B> コマンドの <B>-start</B> 引き数を使用します。コマンドのその他の引き数を使用すると、変換プログラムの他の動作を制御することができます。
<UL>
<LI><B>-convert</B> 引き数は、
NFS にエクスポートされる AFS ファイルまたはディレクトリーの 2 番目および 3 番目 (<B>グループ</B>および<B>その他</B>) のセットの UNIX モード・ビットが、最初の (<B>所有者</B>) モード・ビットに一致するかどうかを制御します。デフォルトでは、モード・ビットが一致するよう設定されています。
<P>
<P>AFS とは異なり、
NFS は、ユーザーがファイルの読み取り / 書き込みを行えるかを (AFS に保管されている場合でも) 判別する際、
3 セットのモード・ビットをすべて使用します。
AFS は、<B>所有者</B>ビットをファイル・ディレクトリーの ACL と組み合わせて使用するため、
AFS ファイルには、<B>グループ</B>および<B>その他</B>のモード・ビットがオンにされていないものもあります。
<B>所有者</B>モード・ビットのみが設定されている場合、NFS はファイルの所有者にのみその書き込み/読み取りを許可します。
<B>-convert</B> 引き数の値を <B>on</B> にすることにより、他のユーザーが所有者として同様にファイルにアクセスできるようにします。値を <B>off</B> にすることにより、ファイルに設定されたモード・ビットを AFS に保管された状態と同じにします。
</LI><LI><B>-uidcheck</B> 引き数は、NFS クライアント・マシン上でのローカル UID が、変換プログラム・マシン上のトークンに関連付けられたローカル UID とは異なる NFS ユーザーにトークンが割り当て可能かどうかを制御します。デフォルトでは、これは可能です。
<P>
<P>値を <B>on</B> に設定して UID チェックをオンにすると、ローカル UID がトークンを割り当てる変換プログラム・マシンのプロセスのローカル UID と同じである NFS ユーザーにのみ、トークンを割り当てることができます。この結果、
<B>knfs</B> コマンドに <B>-id</B> 引き数を組み込みことは意味がありません。受け入れ可能な値は、コマンドの発行者のローカル UID のみであり、これは <B>-id</B> 引き数が省略された場合に使用される値です。このようにして UID の一致を要求するのは、ユーザーが変換プログラム・マシンと NFS クライアント・マシンで同じローカル UID を持つ場合にのみ有効です。この場合、ユーザーがトークンを自らの NFS セッションにのみ割り当てるよう保証できます。説明については、<A HREF="#HDRWQ838">非サポート NFS クライアント・マシンでの認証</A>を参照してください。
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">また、UID チェックをオンにすることにより、サポートされる NFS クライアントのユーザーが <B>klog</B> コマンドを使用して NFS クライアント上で直接認証することがないようにできます。ユーザーは代わりに、変換プログラム・マシン上で認証を行い <B>knfs</B> コマンドを使用しなくてはなりません。これは、<B>klog</B> コマンド・インタープリターが NFS クライアント上でトークンを取得した後、これをキャッシュ・マネージャーのリモート実行プログラム・デーモンに渡し、これにより変換プログラム・マシン上の資格認定構造にトークンを保管するシステム呼び出しを行うためです。リモート・実行プログラムは一般的にローカル・スーパーユーザー <B>root</B> として実行されるため、ほとんどの場合そのローカル UID (通常はゼロ) は、
NFS クライアント・マシンで <B>klog</B> コマンドを発行したユーザーのローカル UID とは一致しません。
<P>
<P>一方で、
<B>klog</B> コマンドの代わりに <B>knfs</B> コマンドを使用するのはユーザーにとって不便ですが、セキュリティーが公開されるのを防ぐことができます。
<B>klog</B> コマンド・インタープリターは、ネットワーク経由でリモート実行プログラム・デーモンにトークンを明示的なテキスト・モードで渡します。
</TD></TR></TABLE>
<P>
<P>値 <B>off</B> を割り当てて UID チェックを使用不可にした場合、<B>knfs</B> コマンドの発行者は、
NFS クライアント・マシン上で異なるローカル UID (ローカル・スーパーユーザー <B>root</B> など) を持つユーザーにトークンを割り当てることができます。さらには、<B>knfs</B> コマンドの複数の発行者が、
NFS クライアント・マシン上の同一ユーザーにトークンを割り当てることができます。異なるユーザーが <B>-id</B> 引き数に同じ値を指定して <B>knfs</B> コマンドを発行するたびに、そのユーザーのトークンが既存のトークンを上書きします。これにより、NFS ユーザーに対して予期されないアクセスが発生する場合があります。
</LI><LI><B>-submounts</B> 引き数は、
NFS クライアントのユーザーが、最上位の <B>/afs</B> ディレクトリー以外に AFS ディレクトリーを取り付けられるかを制御します。デフォルトでは、変換プログラムはこのようなサブマウントを許可しません。
<P>
<P>サブマウントは、いくつかの状況において役に立ちます。たとえば、
NFS ユーザーが自らの AFS ホーム・ディレクトリーにアクセスすればよいだけの場合、サブマウントを使用することにより、ユーザーは完全パスを知って入力する必要はなくなります。同様にして、ユーザーが AFS 階層内でサブマウントより上位のファイル・スペースのパーツにアクセスしないようにできます。
</LI></UL>
<P><H3><A NAME="Header_679" HREF="auagd002.htm#ToC_679">NFS/AFS 変換プログラム・マシンを構成するには</A></H3>
<P>以下の説明では、ユーザーが AFS コマンドを発行できるよう変換プログラムを構成する方法を示します。この機能を使用可能にしたくない場合には、
<A HREF="#LIWQ831">6</A> のステップを省略します。
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI>NFS サーバーがまだない場合には、
NFS/AFS 変換プログラム・マシンを NFS サーバーとして構成します。ユーザーの NFS 提供者が出す指示に従います。
NFS サーバー・デーモン (<B>nfsd</B> など) の数は、潜在的な NFS クライアントの数により異なります。
</LI><LI>AFS クライアントがまだない場合には、
NFS/AFS 変換プログラムを AFS クライアントとして構成します。予測しうる最上のパフォーマンスを得るため、変換プログラム・マシンにおける <B>/usr/vice/etc/CellServDB</B> および <B>/usr/vice/etc/ThisCell</B> ファイルのローカル・コピーは、セル内の他のクライアント・マシンと同じにする必要があります。
</LI><LI><A NAME="LITRANS-MOUNTFILE"></A>リモート NFS クライアントにより、マシンのディレクトリーの取り付けを制御するファイルを変更します。
<UL>
<A NAME="IDX8169"></A>
<A NAME="IDX8170"></A>
<LI><B>/etc/exports</B> ファイルを使用するシステムでは、
NFS クライアントに <B>/afs</B> ディレクトリーのエクスポートを許可する行を組み込みます。特定のユーザーにのみアクセスを与える場合は、特定の NFS クライアント・マシン名のリストを作成します。ファイル形式の説明については、
<B>exports(5)</B> の NFS 解説書のページを参照してください。
<P>
<P>以下の例を使用すると、
NFS クライアント・マシンは、<B>/afs</B>、<B>/usr</B>、および <B>/usr2</B> ディレクトリーを取り付けることができます。
<P>
<PRE>   /afs
   /usr
   /usr2
</PRE>
<A NAME="IDX8171"></A>
<A NAME="IDX8172"></A>
</LI><LI><B>share</B> コマンドを使用するシステムでは、
<B>/etc/dfs/dfstab</B> ファイルまたはこれと同等のファイルに、
<B>/afs</B> ディレクトリーのリモート取り付けを許可する <B>share</B> 命令を組み込みます。ほとんどの配布には、<B>/usr/sbin/share</B> のバイナリーが含まれています。以下の例のコマンドは、ルート区分 (<B>/</B>) のリモート取り付けと <B>/afs</B> ディレクトリーのリモート取り付けを許可しています。構文が正しいことを確認するには、解説書の <B>share</B> コマンドのページを参照してください。
<P>
<PRE>   share -F nfs -o rw -d "root" /
   share -F nfs -o rw -d "afs gateway" /afs
</PRE>
</LI></UL>
</LI><LI>マシンの AFS 初期設定ファイルを編集して、
<B>afsd</B> プログラムを実行した後に標準 UNIX <B>exportfs</B> コマンドを呼び出すようにします。システム・タイプによっては、
<A HREF="#LITRANS-MOUNTFILE">4</A> のステップで行った変更だけで <B>/afs</B> ディレクトリー経由で AFS ファイル・スペースをエクスポートすることができない場合があります。これは、マシンの初期設定の際、<B>afsd</B> プログラムが実行される前に構成の変更が行われるためです。
<B>afsd</B> プログラムが実行されて初めて <B>/afs</B> ディレクトリーが AFS ファイル・スペース全体のマウント・ポイントになります。実行する前は、他のディレクトリーと同様にローカル・ディレクトリーです。
</LI><LI><A NAME="LIWQ831"></A>AFS 初期設定ファイルの <B>afsd</B> コマンドを変更して、
<B>-rmtsys</B> フラグを組み込みます。
<P>
<P>IRIX 以外のシステム・タイプの場合、
<I>AFS インストールの手引き</I> のキャッシュ・マネージャーの構成に <B>-rmtsys</B> フラグの追加方法が説明されています。たとえば、スクリプト内の OPTIONS 変数の値の定義行にこれを追加するなどの方法があります。
<P>
<P>IRIX システムでは、<B>afsxnfs</B> 構成変数を活動化すると、
AFS 初期化スクリプトは自動的に <B>-rmtsys</B> フラグを追加します。
<I>AFS インストールの手引き</I> のカーネルへの AFS 拡張の組み込みについての説明を参照してください。変数が活動化されていなければ、以下のコマンドを発行します。
<P>
<PRE>
   # <B>/etc/chkconfig  -f  afsxnfs  on</B>
</PRE>
</LI><LI><B>(オプション)</B> このマシンに期待できる NFS クライアントの数によって、マシンの初期設定ファイルの <B>afsd</B> コマンドに、バックグラウンド・デーモン数を設定する <B>-daemons</B> 引き数などの他の引き数を追加してもかまいません。『<A HREF="auagd015.htm#HDRWQ513">クライアント・マシンとキャッシュ・マネージャーの管理</A>』および『 <I>AFS Administration Reference</I>』の <B>afsd</B> 解説ページを参照してください。
</LI><LI>マシンをリブートする。多くのシステム・タイプでは、適切なコマンドは
<B>shutdown</B> です。ユーザーのオペレーティング・システム管理者の手引きを調べてください。
<P>
<PRE>   # <B>shutdown</B> <VAR>appropriate_options</VAR>
</PRE>
</LI></OL>
<A NAME="IDX8173"></A>
<A NAME="IDX8174"></A>
<P><H3><A NAME="Header_680" HREF="auagd002.htm#ToC_680">変換プログラム機能を使用不可/使用可能にする、またはオプション機能を設定する</A></H3>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI><B>fs exportafs</B> コマンドを発行します。
<P>
<PRE>   # <B>fs exportafs nfs</B> [<B>-start</B> {<B>on</B> | <B>off</B>}} ]  [<B>-convert</B> {<B>on</B> | <B>off</B>}]
                      [<B>-uidcheck</B> {<B>on</B> | <B>off</B>}]   [<B>-submounts</B> {<B>on</B> | <B>off</B>}]
</PRE>
<P>
<DL>
<P><DT><B>-start
</B><DD><B>off</B> の場合変換プログラム機能を使用不可に、
<B>on</B> にすると再度使用可能にします。この引き数を省略すると、このコマンドにより設定されたすべてのパラメーターの現在の設定が表示されます。
<P><DT><B>-convert
</B><DD>NFS にクライアントにエクスポートされる AFS ファイルまたはディレクトリーの
2 番目と 3 番目 (<B>グループ</B>と<B>その他</B>) のセットの UNIX モード・ビットの設定を制御します。
<B>on</B> の場合、<B>所有者</B> モード・ビットに一致するよう設定されます。
<B>off</B> の場合、ビットは変更されません。この引き数が省略された場合、デフォルト値は <B>on</B> です。
<P><DT><B>-uidcheck
</B><DD><B>knfs</B> コマンドの発行によって、
AFS UID に一致しない <B>-id</B> 引き数の値を指定できるかどうかを制御します。
<UL>
<LI><B>on</B> の場合、<B>-id</B> 引き数の値は発行者のローカル UID に一致する必要があります。
</LI><LI><B>off</B> の場合、<B>knfs</B> コマンドの発行者は <B>-id</B> 引き数を使用して、
NFS クライアント・マシン上で異なるローカル UID (ローカル・スーパーユーザー <B>root</B> など) を持つユーザーにトークンを割り当てることができます。
</LI></UL>
<P>
<P>
<P>この引き数が省略されると、デフォルト値は <B>off</B> です。
<P><DT><B>-submounts
</B><DD>変換プログラムが、最上位の <B>/afs</B> ディレクトリー以外に AFS ファイル・スペース内のディレクトリーの NFS マウントをサービスするかを制御します。
<B>on</B> の場合、サブマウントが許可されます。
off の場合、<B>/afs</B> ディレクトリーの取り付けのみが許可されます。この引き数が省略されると、デフォルト値は <B>off</B> です。
</DL>
</LI></OL>
<HR><H2><A NAME="HDRWQ832" HREF="auagd002.htm#ToC_681">NFS クライアント・マシンの構成</A></H2>
<P>以下の要件を満たす NFS クライアント・マシンはいずれも NFS/AFS 変換プログラム経由で AFS 内のファイルにアクセスできます。これを AFS クライアント・マシンとして構成する必要はありません。
<UL>
<LI>変換プログラム・マシンの <B>/afs</B> ディレクトリーを、ローカル・ディレクトリー (通常これも <B>/afs</B> とされる) に NFS マウントする必要があります。以下に、NFS クライアント・マシンの <B>/etc/fstab</B> ファイル (または同等のファイル) に <B>mount</B> コマンドを追加する方法を示します。
<P>
<P>NFS クライアントが変換プログラム・マシンの <B>/afs</B> ディレクトリーを取り付けるディレクトリーでは、
<B>/afs</B> 以外のものが呼び出されることがあります。たとえば、オリジナルのディレクトリーにアクセスできなくなった場合に他の変換プログラムへの切り替えが容易にできるよう、複数の変換プログラム・マシンの <B>/afs</B> ディレクトリーを取り付けることができます。通常使用する変換プログラムのマシンの取り付けに <B>/afs</B> と名前を付け、代替変換プログラム・マシン用にはそれぞれ異なる名前を付けます。
<P>
<P><B>/afs</B> 以外ディレクトリーに AFS ファイル・スペースを取り付けるには、この他にも必要な要件がありますが、
AFS パス名の引き数をとるコマンドを発行する場合には、相対パス名ではなく、<B>/afs</B> に始まる完全パス名を指定する必要があります。たとえば、変換プログラム・マシンの AFS ファイル・スペースが NFS クライアント・マシンの <B>/afs2</B> に取り付けられており、以下のコマンドを発行して現行の作業ディレクトリー (AFS) の ACL を表示するとします。
<P>
<PRE>   % <B>fs listacl .</B>
</PRE>
<P>
<P>NFS クライアント側の <B>fs</B> コマンド・インタープリターは全パス名を構成してから、変換プログラム・マシンのキャッシュ・マネージャーに要求を渡す必要があります。
AFS ファイル・スペースは <B>/afs2</B> 取り付けられているため、全パス名はこの文字列で開始します。ただし、変換プログラム・マシンでは AFS ファイル・スペースが <B>/afs</B> 名で取り付けられているため、キャッシュ・マネージャーは <B>/afs2</B> 名のディレクトリーを見つけることができません。コマンドは失敗します。この障害を避けるため、ファイルには文字列 <B>/afs</B> で開始する全パス名を指定します。
</LI><LI>適切な数の NFS クライアント <B>biod</B> デーモンを実行する必要があります。このデーモンは、事前読み取りと遅延書き込みを処理することによって、パフォーマンスを改善します。ほとんどの NFS ベンダーは、このような 4 つのデーモンの実行を推奨し、ほとんどの NFS 初期化スクリプトは、これらを自動的に開始します。ご使用の NFS 資料を調べてください。
</LI></UL>
<P>ユーザーが AFS コマンドを発行できるようにするには、
NFS クライアント・マシンが、サポートされるシステム・タイプ (AFS バイナリーが使用可能なシステム・タイプ) であり、
AFS コマンド・バイナリーにアクセス可能であることが必要です。<I>AFS Release Notes</I> には、リリースごとのサポートされるシステム・タイプがリストされています。
<P>また、<A HREF="#HDRWQ826">AFSSERVER および AFSCONF 環境変数の設定</A> の説明に従い、
AFSSERVER および AFSCONF 環境変数も定義しなければなりません。
<P><H3><A NAME="Header_682" HREF="auagd002.htm#ToC_682">NFS クライアント・マシンを構成して、AFS にアクセスするには</A></H3>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">以下の指示に従い、NFS ユーザーが AFS コマンドを発行できるようにします。この機能を使用可能にしたくない場合には、
<A HREF="#LIWQ834">5</A> および <A HREF="#LIWQ835">6</A> のステップを省略します。
</TD></TR></TABLE>
<OL TYPE=1>
<LI>まだの場合は、<B>su</B> コマンドを発行し、マシン上でローカル・スーパーユーザー <B>root</B> になります。
<P>
<PRE>   % <B>su root</B>
   Password: <VAR>root_password</VAR>
</PRE>
</LI><LI>NFS クライアント・マシンがまだない場合には、そのマシンを NFS クライアント・マシンとして構成する。
NFS ベンダーの提供する指示に従います。
NFS クライアント (<B>biod</B>) デーモンの数は、このマシンで予想される負荷に適していなければなりません。通常の推奨される数は 4 つです。
</LI><LI><B>/afs</B> というディレクトリーがまだない場合は、そのディレクトリーをマシンに作成し、変換プログラム・マシンの <B>/afs</B> ディレクトリーのマウント・ポイントとして使用します。別の名前を付けることもできますが、このセクションの概要で説明したように制限があります。
<P>
<PRE>   # <B>mkdir /afs</B>
</PRE>
<A NAME="IDX8175"></A>
<A NAME="IDX8176"></A>
</LI><LI><A NAME="LIWQ833"></A>マシンのファイル・システム登録ファイル(<B>/etc/fstab</B> または同等のファイル) を変更して、変換プログラム・マシンの <B>/afs</B> ディレクトリーを取り付けるコマンドを組み込みます。<B>mount</B> コマンドの正しい構文を確認するには、オペレーティング・システムの <B>mount(5)</B> の解説ページを参照してください。以下の例には、多くのシステム・タイプで使用可能なオプションが組み込まれています。
<P>
<PRE>   mount -o hard,intr,timeo=300  <VAR>translator_machine</VAR>:/afs /afs
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B><TT>hard</TT>
</B><DD>NFS サーバー (変換プログラム・マシン) が応答するまで、
NFS クライアントは NFS 要求を再試行しなければならないことを示します。変換プログラムを使用する場合、ファイル操作は AFS キャッシュ・マネージャーを経由するため、
NFS 単独より時間がかかります。soft 取り付けでは、変換プログラムからの遅延応答は、要求が打ち切られる原因になります。多くの NFS バージョンでは、デフォルトによって、堅固な取り付けが使用されます。ご使用のバージョンで使用していない場合は、このオプションを追加することをお勧めします。
<P><DT><B><TT>intr</TT>
</B><DD>これによって、ユーザーはキーボード割り込みシグナル
(&lt;<B>Ctrl-c</B>&gt; など) を使用し、変換プログラム・マシンが停止し、作業が不可能になったときに、取り付けを切断します。このオプションを組み込むのは、<TT>hard</TT> オプションを使用する場合だけです。なぜなら、変換プログラム・マシンが停止しても、接続は自動的に中断しないからです。
<P><DT><B><TT>timeo</TT>
</B><DD>クライアントが要求がタイムアウトになったと判断するまで、変換プログラムが NFS クライアントの要求に応答するのに掛かる最大時間 (10 秒間隔) を設定します。堅固な取り付けでは、このオプションを 300 のような高い数字に設定すると、変換プログラムがただちに応答しないときに生成される、以下のようなエラー・メッセージの数が減少します。
<P>
<PRE>   NFS server <VAR>translator</VAR> is not responding, still trying
</PRE>
<P>
<P>
<P>柔軟な取り付けでは、タイムアウトになった要求に戻される実際のエラーの数が減少します。
<P><DT><B><VAR>translator_machine</VAR>
</B><DD><B>/afs</B> ディレクトリーをクライアント・マシンの <B>/afs</B> ディレクトリーに取り付ける変換プログラム・マシンを指定します。
</DL>
<P>
<TABLE><TR><TD ALIGN="LEFT" VALIGN="TOP"><B>注:</B></TD><TD ALIGN="LEFT" VALIGN="TOP">変換プログラム・マシンの <B>/afs</B> ディレクトリーを <B>/afs</B> 以外の NFS クライアントのディレクトリーに取り付ける場合には、代替のディレクトリー名を用いて <B>mount</B> コマンドの 2 番目の <TT>/afs</TT> インスタンスを置き換えます。
</TD></TR></TABLE>
</LI><LI><A NAME="LIWQ834"></A><B>(オプション)</B> 必要があれば、
<B>/.AFSSERVER</B> ファイルを作成し、すべてのマシン・ユーザーについて AFSSERVER 環境変数を設定します。詳細は、
<A HREF="#HDRWQ826">AFSSERVER および AFSCONF 環境変数の設定</A> を参照してください。リモート実行プログラムとして機能する変換プログラム・マシンの完全修飾ホスト名を指定する単一行をファイルに追加します。トークンを処理するコマンドをユーザーが発行できるようにするには、これは、
<A HREF="#LIWQ833">4</A> のステップの <VAR>translator_machine</VAR> 名のマシンとする必要があります。
</LI><LI><A NAME="LIWQ835"></A><B>(オプション)</B> 必要があれば、
<B>/.AFSCONF</B> ファイルを作成して、すべてのマシン・ユーザーについて AFSCONF 環境変数を設定します。詳細は、
<A HREF="#HDRWQ826">AFSSERVER および AFSCONF 環境変数の設定</A> を参照してください。
<B>CellServDB</B> および <B>ThisCell</B> ファイルが常駐するディレクトリーの名前を指定する単一行をファイルに追加します。これらのファイルの中央更新ソース (標準では <B>/afs/</B><VAR>cellname</VAR><B>/common/etc</B>) を使用する場合、ここで指定します。
</LI></OL>
<HR><H2><A NAME="HDRWQ836" HREF="auagd002.htm#ToC_683">ユーザー・アカウントの構成</A></H2>
<P>NFS ユーザーが非認証のユーザーとして AFS にアクセスするには、要件はありません。ただし、AFS 機能をさらに活用するには、次に示す要件を満たす必要があります。
<UL>
<LI>認証ユーザーとして AFS にアクセスするには、
AFS で認証を行う必要があります。これには保護データベースと認証データベースに項目が必要です。
</LI><LI>ファイルを作成し保管するには、要求される ACL アクセス権が必要です。個人ファイルの保管にホーム・ディレクトリーを使用する場合、通常は専用ボリュームを作成し、これを AFS ファイル・スペースのユーザー・ホーム・ディレクトリー・ロケーションにマウントします。
</LI><LI>AFS コマンドを発行するには、いくつかの追加要件があります。
<UL>
<LI>サポートされるシステム・タイプの NFS クライアント・マシンで、
AFS コマンド・バイナリーにアクセス可能なマシンで作業をする必要があります。
</LI><LI>コマンド・シェルは、AFSSERVER および AFSCONF 環境変数の値を定義する必要があります (<A HREF="#HDRWQ826">AFSSERVER および AFSCONF 環境変数の設定</A> を参照)。
NFS クライアント・マシンのルート・ディレクトリーに <B>/.AFSSERVER</B> および <B>/.AFSCONF</B> ファイルを作成して変数を定義するのが最も簡単である場合が多いですが、各ユーザーのシェル初期化ファイル (<B>.cshrc</B> または同等のファイル) に変数を設定するか、各ユーザーのホーム・ディレクトリーに <B>.AFSSERVER</B> および <B>.AFSCONF</B> 名のファイルを作成することもできます。
</LI><LI>コマンドが AFS 特権を要求する場合に認証を行えるよう、
AFS 保護データベースと認証データベースに項目が必要です。その他のコマンドでは、変換プログラム・マシンにおけるローカル <B>root</B> 識別を前提とします。詳細については、<A HREF="#HDRWQ827">AFSSERVER 変数</A> を参照してください。
</LI><LI>PATH 環境変数には、適当な AFS バイナリーのパス名を組み込む必要があります。ユーザーが、異なるシステム・タイプの NFS クライアント・マシンで作業をする場合には、パス名に実際のシステム・タイプ名ではなく、<B>@sys</B> 変数を組み込みます。
</LI></UL>
</LI></UL>
<P><H3><A NAME="Header_684" HREF="auagd002.htm#ToC_684">AFS コマンドを発行するためのユーザー・アカウントの構成</A></H3>
<OL TYPE=1>
<LI>保護データベースと認証データベースにユーザー用の項目を作成するか、完全な AFS アカウントを作成する。
<A HREF="auagd017.htm#HDRWQ602">uss コマンド組によるユーザー・アカウントの作成と削除</A> または <A HREF="auagd018.htm#HDRWQ663">ユーザー・アカウントの管理</A>のアカウントの作成の説明を参照してください。
</LI><LI><A NAME="LIWQ837"></A>ユーザーの PATH 環境変数を変更して、
<B>/afs/</B><VAR>cellname</VAR><B>/</B><VAR>sysname</VAR><B>/usr/afsws/bin</B> などの AFS バイナリーのパス名を組み込む。ユーザーが、異なるシステム・タイプの NFS クライアント・マシンで作業をする場合には、特定の <VAR>sysname</VAR> を <B>@sys</B> 変数に置き換えるよう考慮します。一般的に、PATH 変数は、ログイン・ファイルまたはシェル初期設定ファイル
(<B>.login</B> または <B>.cshrc</B> など) で定義されます。
</LI><LI><B>(オプション)</B> 必要であれば、AFSSERVER および AFSCONF 環境変数を定義します。これは、ユーザーが作業をする NFS クライアント・マシンに <B>/.AFSSERVER</B> および <B>/.AFSCONF</B> ファイルがない場合、またはユーザー固有の値でこれらの設定を上書きする場合に必要となります。
<P>
<P>ユーザーのログインまたはシェル初期設定ファイルに変数を定義するか、ユーザーのホーム・ディレクトリーに <B>.AFSSERVER</B> および <B>.AFSCONF</B> ファイルを作成します。
<P>
<P>AFSSERVER 変数の場合、リモート実行プログラムとして機能する変換プログラム・マシンの完全修飾ホスト名を指定します。
AFSCONF 変数には、
<B>CellServDB</B> および <B>ThisCell</B> ファイルが常駐するディレクトリーの名前を指定します。これらのファイルの中央更新ソース (標準では <B>/afs/</B><VAR>cellname</VAR><B>/common/etc</B>) を使用する場合、ここで指定します。
</LI><LI><A HREF="#LIWQ837">2</A> のステップで定義したパス名に <B>@sys</B> 変数が組み込まれている場合には、システム名が正しく定義されていることを確認してから AFS コマンドを発行するようユーザーに指示します。ユーザーは以下のコマンドを発行します。
<P>
<PRE>   % <B>fs sysname</B>
</PRE>
</LI></OL>
<HR><H2><A NAME="HDRWQ838" HREF="auagd002.htm#ToC_685">非サポート NFS クライアント・マシンでの認証</A></H2>
<P><B>knfs</B> コマンドを使用すると、ユーザーは、非サポートのシステム・タイプ (AFS バイナリーを使用できないタイプ) の NFS クライアントで作業をする際に、
AFS で認証を行うことができます。これで、このようなユーザーも、ほかの AFS ユーザーと同じ範囲まで、
AFS ファイル・ツリーにアクセスすることができます。ただし、AFS コマンドを発行することはできません。これらのコマンドは、サポートされるシステム・タイプの NFS クライアント・マシンでしか発行できません。
<P>非サポート・システムで認証を行うには、変換プログラム・マシンへの接続を確立し (<B>telnet</B> などの機能を使用)、
<B>klog</B> コマンドを使用して、次の NFS セッションで接続するすべてのセルに対するトークンを取得します。続いて <B>knfs</B> コマンドを発行します。これにより、NFS セッションに関連した資格認定構造にトークンを保管します。キャッシュ・マネージャーは、
NFS セッションから発生した AFS アクセス要求を実行する際、トークンを使用します。
<P>詳しく述べると、この資格認定構造は、特定の NFS クライアント・マシン上の特定のローカル UID に関連したプロセス認証グループ (PAG) 番号により識別されます。デフォルトでは、資格認定構造に記録された NFS UID は、変換プログラム・マシン上のローカル UID に同じです。
<B>-id</B> 引き数を組み込んで代替の NFS UID を指定することができます。ただし、変換プログラム・マシンの管理者が <B>fs exportafs</B> コマンドの <B>-uidcheck</B> 引き数を使用して UID チェックを使用可能にした場合は除きます。この場合、<B>-id</B> 引き数の値は、変換プログラム・マシン上のローカル UID と同じでなくてはなりません
(このため、<B>-id</B> 引き数を指定する意味はありません)。UID を一致するよう強制することで、他ユーザーが偶然または故意に、資格認定構造内にそのトークンを置くことができないようにします。ただしこのことは、セル管理者が NFS クライアント上のユーザーのローカル UID を変換プログラム・マシン上でのローカル UID に一致するよう設定しなくてはならないことを意味します。また、<B>klog</B> コマンドを発行してサポート NFS クライアントで認証を行うことが不可能となり、すべての NFS ユーザーは <B>knfs</B> コマンドを使用しなくてはなりません。<A HREF="#HDRWQ830">オプションの変換プログラム機能の制御</A>を参照してください。
<P><B>knfs</B> コマンドを発行したら、
AFS への認証アクセスを行い NFS クライアント上で作業を開始できます。作業が終了したら、変換プログラム・マシン上で再度 <B>knfs</B> コマンドを発行して (この場合は <B>-unlog</B> フラグを使用)、トークンを破棄するのが適切な方法です。変換プログラム・マシンへの接続をオープンにしておく方が簡単ですが、元の接続をクローズすると、常に新規接続を開始することができます。
<P>NFS クライアント・マシンが、サポートされるシステム・タイプで、そのマシンで AFS コマンドを発行するのであれば、
<B>knfs</B> コマンドに <B>-sysname</B> 引き数を組み込みます。変換プログラム・マシンのリモート実行プログラム・デーモンはこの値を使用して、ユーザーが NFS クライアント・マシンで発行した AFS コマンドを実行する際、パス名の <B>@sys</B> 変数を置き換えます。
PATH 環境変数が AFS バイナリーのディレクトリーのパス名に <B>@sys</B> 変数を使用する場合 (推奨方法)、この引き数を設定することにより、リモート実行プログラム・デーモンは、変換プログラム・マシンとはシステム・タイプが異なる場合でも、
NFS クライアント・マシンに適当な AFS バイナリーにアクセスすることができます。
<P><B>knfs</B> コマンド (または NFS クライアント・マシンがサポート・システム・タイプの場合、このマシン上で <B>klog</B> コマンド) を発行しないと、AFS で認証はされません。非認証のアクセスについての説明は、
<A HREF="#HDRWQ825">非認証または認証済みの AFS アクセスを使用可能にする</A> を参照してください。
<A NAME="IDX8177"></A>
<A NAME="IDX8178"></A>
<P><H3><A NAME="Header_686" HREF="auagd002.htm#ToC_686">knfs コマンドを使用した認証</A></H3>
<OL TYPE=1>
<LI>関係のある変換プログラム・マシンにログオンします。コンソールを使用、または <B>telnet</B> などのプログラムをリモートで使用します。
</LI><LI>NFS クライアントでの作業中にアクセスするすべてのセルのトークンを取得します。デフォルトでは、AFS 使用に変更されたログイン・ユーティリティーが、変換プログラム・マシンのローカル・セルのトークンを入手します。必要であれば、<B>klog</B> コマンドを使用して、他のセルのトークンを入手します。
</LI><LI><B>knfs</B> コマンドを発行し、前のステップで取得したトークンの保管用に、変換プログラム・マシンのカーネル・メモリーに資格認定構造を作成します。変換プログラム・マシン上のローカル UID とは異なる NFS クライアントの UID に構造を関連付けるには、
<B>-id</B> 引き数を組み込みます。これは、変換プログラム・マシンで管理者が UID チェックを使用可能にしていない場合に可能です。<A HREF="#HDRWQ830">オプションの変換プログラム機能の制御</A> を参照してください。
NFS クライアント・マシンが、サポートされるシステム・タイプで、そのマシンで AFS コマンドを発行するのであれば、<B>-sysname</B> 引き数を組み込んでそのシステム・タイプを指定します。
<P>
<PRE>   % <B>knfs -host</B> &lt;<VAR>host name</VAR>>  [<B>-id</B> &lt;<VAR>user ID (decimal)</VAR>>]
                [<B>-sysname</B>  &lt;<VAR>host's '@sys' value</VAR>>]
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>-host
</B><DD>作業を行う NFS クライアント・マシンの完全修飾ホスト名を指定します。
<P><DT><B>-id
</B><DD>トークンを関連付ける NFS クライアント・マシンのローカル UID 番号を指定します (変換プログラム・マシン上のローカル UID と異なる場合)。この引き数を省略した場合、トークンは、変換プログラム・マシン上のローカル UID に一致する NFS UID に関連付けられます。いずれの場合も NFS クライアント・ソフトウェアは、
AFS アクセス要求を変換プログラム・マシンのキャッシュ・マネージャーに転送する際、
NFS UID でマークを付けます。
<P><DT><B>-sysname
</B><DD>ローカル・マシンのリモート実行プログラム・デーモンが、
NFS クライアント・マシンで発行された AFS コマンドを実行する際にパス名の <B>@sys</B> 変数に置き換える値を指定します。クライアント・マシンはサポートされるシステム・タイプである必要があります。
</DL>
<P>
<P>以下のエラー・メッセージは、変換プログラム・マシンの管理者が UID チェックを使用可能にしており、変換プログラム・マシン上のローカル　UID と異なる値をユーザーが指定していることを示します。
<P>
<PRE>
   knfs: Translator in 'passwd sync' mode; remote uid must be the same as local uid
</PRE>
</LI><LI>変換プログラム・マシンへの接続をクローズし (必要な場合)、
NFS クライアント・マシンで作業をします。
</LI></OL>
<A NAME="IDX8179"></A>
<P><H3><A NAME="Header_687" HREF="auagd002.htm#ToC_687">knfs コマンドを使用したトークンの表示</A></H3>
<OL TYPE=1>
<LI>関係のある変換プログラム・マシンにログオンします。コンソールを使用、または <B>telnet</B> などのプログラムをリモートで使用します。
</LI><LI><B>knfs</B> コマンドに <B>-tokens</B> フラグを付けて発行し、変換プログラム・マシン上のローカル UID に一致する NFS UID、または <B>-id</B> 引き数で指定した NFS UID のいずれかに関連するトークンを表示します。
<P>
<PRE>   % <B>knfs -host</B> &lt;<VAR>host name</VAR>>  [<B>-id</B> &lt;<VAR>user ID (decimal)</VAR>>] <B>-tokens</B>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>-host
</B><DD>作業を行う NFS クライアント・マシンの完全修飾ホスト名を指定します。
<P><DT><B>-id
</B><DD>トークンの表示対象となる NFS クライアント・マシンのローカル UID を指定します (変換プログラム・マシン上のローカル UID と異なる場合)。この引き数を省略した場合、変換プログラム・マシン上のローカル UID に一致する NFS UID のトークンとなります。
<P><DT><B>-tokens
</B><DD>トークンを表示します。
</DL>
</LI><LI>必要であれば、変換プログラム・マシンへの接続をクローズします。
</LI></OL>
<A NAME="IDX8180"></A>
<P><H3><A NAME="Header_688" HREF="auagd002.htm#ToC_688">knfs コマンドによるトークンの破棄</A></H3>
<OL TYPE=1>
<LI><B>knfs</B> コマンドの発行後に変換プログラム・マシンへの接続をクローズした場合は、再度オープンします。
</LI><LI><B>knfs</B> コマンドに <B>-unlog</B> フラグを付けて発行します。
<P>
<PRE>   % <B>knfs -host</B>  &lt;<VAR>host name</VAR>>  [<B>-id</B> &lt;<VAR>user ID (decimal)</VAR>>]  <B>-unlog</B>
</PRE>
<P>
<P>ここで、
<P>
<DL>
<P><DT><B>-host
</B><DD>作業を行う NFS クライアント・マシンの完全修飾ホスト名を指定します。
<P><DT><B>-id
</B><DD>関連するトークンを破棄する NFS クライアント・マシンのローカル UID 番号を指定します (変換プログラム・マシン上のローカル UID とはことなる場合)。この引き数を省略した場合、変換プログラム・マシン上のローカル UID に一致する NFS UID に関連するトークンは破棄されます。
<P><DT><B>-unlog
</B><DD>トークンを破棄します。
</DL>
</LI><LI>希望する場合には、変換プログラム・マシンへの接続をクローズする。
</LI></OL>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auagd021.htm">前ページ</A> &#124; <A HREF="auagd023.htm">次ページ</A> &#124; <A HREF="auagd002.htm#ToC">目次</A> &#124; <A HREF="auagd026.htm#HDRINDEX">索引</A> &#93;</B>
<!-- Begin Footer Records  ========================================== -->
<P><HR><B>
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved<!-- 991224 -->
</B>
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>

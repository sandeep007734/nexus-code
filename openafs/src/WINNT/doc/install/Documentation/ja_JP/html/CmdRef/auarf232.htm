<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理解説書</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- C:\IDWB\TEMP\idwt1068\AUARF000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 21:46:04            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 21:46:02">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 21:46:02">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 21:46:02">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    -->
<BODY bgcolor="ffffff">
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理解説書</H1>
<P>
<H2><A NAME="HDRSALVAGER" HREF="auarf002.htm#ToC_246">salvager</A></H2>
<A NAME="IDX5443"></A>
<A NAME="IDX5444"></A>
<A NAME="IDX5445"></A>
<A NAME="IDX5446"></A>
<P><STRONG>目的</STRONG>
<P><B>fs</B> プロセスのサルベージャー・コンポーネントを初期化します。
<P><STRONG>構文</STRONG>
<PRE><B>salvager</B> [<B>initcmd</B>]  [<B>-partition</B> &lt;<VAR>Name of partition to salvage</VAR>>]
         [<B>-volumeid</B> &lt;<VAR>Volume Id to salvage</VAR>>]  [<B>-debug</B>]
         [<B>-nowrite</B>]  [<B>-inodes</B>]  [<B>-force</B>]  [<B>-oktozap</B>]
         [<B>-rootinodes</B>]  [<B>-salvagedirs</B>]  [<B>-blockreads</B>]
         [<B>-parallel</B> &lt;<VAR># of max parallel partition salvaging</VAR>>]
         [<B>-tmpdir</B> &lt;<VAR>Name of dir to place tmp files</VAR>>]
         [<B>-showlog</B>]  [<B>-showsuid</B>]  [<B>-showmounts</B>]
         [<B>-orphans</B> &lt;<B>ignore</B> | <B>remove</B> | <B>attach</B>>] [<B>-help</B>]
</PRE>
<P>このコマンドは、AFS コマンド・セットの構文規則に準拠していません。コマンド名およびすべてのオプション名は省略せずにすべて指定してください。
<P><STRONG>構文</STRONG>
<P><B>salvager</B> コマンドは、
<B>fs</B> プロセスのサルベージャー・コンポーネントを初期化します。通常の構成では、バイナリー・ファイルはファイル・サーバー・マシンの <B>/usr/afs/bin</B> ディレクトリーにあります。
<P>サルベージャーを使用すると、可能な限り、ローカル・ファイル・サーバー・マシン上の破壊された読み取り / 書き込みボリュームの内部整合性が復元されます。読み取り専用ボリュームまたはバックアップ・ボリュームの場合は、以下のとおり、ボリューム・ヘッダーだけを検査します。
<UL>
<LI>ボリューム・ヘッダーが破壊されていると、サルベージャーは、そのボリュームを完全に削除し、そのログ・ファイルである <B>/usr/afs/logs/SalvageLog</B> に削除したことを記録します。
<B>vos release</B> コマンドまたは <B>vos backup</B> コマンドを発行して、読み取り専用ボリュームまたはバックアップ・ボリュームを再作成します。
</LI><LI>ボリューム・ヘッダーが壊れていない場合、サルベージャーは、そのボリュームをスキップします (内容の破壊について検査しません)。ただし、ファイル・サーバーは、初期化の際に破壊を検知すると、そのボリュームの接続またはオンライン接続を拒否する場合があります。この場合、<B>vos remove</B> コマンドまたは <B>vos zap</B> コマンドを発行して、そのボリュームを削除するのが最も簡単です。次に、<B>vos release</B> コマンドまたは <B>vos backup</B> コマンドを発行して、ボリュームを再作成します。
</LI></UL>
<P><B>salvager</B> コマンドは、他のサーバー・プロセスの初期設定コマンドと異なり、
<B>bos create</B> コマンドと一緒に <B>/usr/afs/local/BosConfig</B> に記述されると同時に、コマンド・シェル・プロンプトからも発行されるように設計されています。
<B>bos salvage</B> コマンドを発行して、サルベージャーをリモートで起動することもできます。
<P>コマンドのオプションを指示どおりに組み合わせて、以下のように、さまざまな数の読み取り / 書き込みボリュームをサルベージします。
<UL>
<LI>ファイル・サーバー・マシンのすべてのボリュームをサルベージする場合は、引き数を指定しません。サルベージ操作中に、キャッシュ・マネージャーは、マシン上のどのボリュームにもアクセスできません。サルベージャーの実行中は、BOS サーバーがファイル・サーバー・プロセスおよびボリューム・サーバー・プロセスを停止するためです。
</LI><LI>1 つの区画にあるすべてのボリュームをサルベージする場合は、
<B>-partition</B> 引き数を指定します。マシン上のすべてのボリュームのサルベージに関して、サルベージ操作中に、キャッシュ・マネージャーは、マシン上のどのボリュームにもアクセスできません。
</LI><LI>1 つのボリュームのみをサルベージする場合は、
<B>-partition</B> 引き数と <B>-volumeid</B> 引き数を組み合わせて使用します。キャッシュ・マネージャーは、そのボリュームにだけアクセスできません。
BOS サーバーが、ファイル・サーバー・プロセスもボリューム・サーバー・プロセスも終了していないためです。
</LI></UL>
<P>サルベージャーは、通常、破壊発生時に活動状態であったことがマークされている、読み取り / 書き込みボリュームだけをサルベージします。関係のあるすべての読み取り / 書き込みボリュームをサルベージさせるには、
<B>-force</B> フラグを追加します。
<P>サルベージャーは通常、損傷を修理するときに新規 i ノードを作成します。区画がいっぱいで、新規 i ノードを作成する空間がない場合は、
<B>-nowrite</B> 引き数を使用して、損傷したボリュームのサルベージを試みずに、未損傷のボリュームをオンラインにします。次に <B>vos move</B> コマンドを使用して、1 つまたは複数の未損傷のボリュームを別の区画に移動し、サルベージャーが新しい i ノードを作成するために必要なスペースを解放します。
<P>デフォルトでは、複数のサルベージャー・サブプロセスは、
1 つの区画ごとに 4 つまで、4 つ以上の区画の場合には、4 つのサブプロセスを並行して実行します。並行して実行するサブプロセス数を増減する場合は、
<B>-parallel</B> 引き数に正の整数値を指定してください。
<P>物理ディスク上に複数のサーバー区画がある場合、デフォルトでは、サルベージャーは、ディスク・ヘッドをある区画から別の区画に絶えず移動させる非効率を避けるために、それらの区画を直列的にサルベージします。しかし、区画が複数のディスクにまたがる論理ボリュームとして構成されている場合には、このストラテジーが理想的でないことがあります。論理ボリュームを並行してサルベージすることをサルベージャーに強制するには、
<B>-parallel</B> 引き数に対する値として、文字列 <B>all</B> を指定します。サルベージされる論理ボリュームの数に依存して、並行して実行するサブプロセスの数を指定するために正の整数を与えるか (たとえば、
5 つのサブプロセスの場合は、<B>-parallel 5all</B>)、あるいは 4 つまでのサブプロセスを実行する場合は、整数を省略します。
<P>サルベージャーは、実行中に一時ファイルを作成します。デフォルトでは、これらのファイルはサルベージしている区画に書き込まれます。一時ファイルはかなりの数になることがあるため、区画に十分なスペースがないと、サルベージャーはこのサルベージ操作を完了せずに終了する場合があります (サルベージャーは常に、終了前には一時ファイルを削除します)。一時ファイル用に十分なディスク・スペースを持つ区画が他にあれば、他のすべての区画のサルベージを終了するまで、同時に実行されている他のサルベージャー・サブプロセスは処理を継続します。中断したサルベージ操作を完了するには、<B>-tmpdir</B> 引き数を付けて該当する区画にコマンドを再発行して、十分なスペースを持つローカル・ディスク・ディレクトリーに一時ファイルが書き込まれるように指定してください。
<P><B>-orphans</B> 引き数は、サルベージャーが、サルベージしているサーバーの区画上で検出したオーファン・ファイルとディレクトリーを処理する方法を制御します。
<I>オーファン</I>要素には、アクセスすることはまったくできません。それは、(ファイル・スペースの上位にある) オーファン要素の親として働くディレクトリーの vnode から参照されないからです。オーファン・オブジェクトは、サーバー区画上にスペースを占めますが、ボリュームの割り当て量に不利になることはありません。
<P>1 つまたは複数のボリュームに常駐するすべてのマウント・ポイントのリストを、これらのポイントを実際にサルベージせずに生成するには、<B>-showmounts</B> フラグを指定します。
<P><STRONG>オプション </STRONG>
<DL>
<P><DT><B>initcmd
</B><DD>コマンドの AFS コマンド・パーサーの使用状況を調べます。これはオプションです。
<P><DT><B>-partition
</B><DD>サルベージする区画名を指定します。フォーム <B>/vicep</B><VAR>x</VAR> または <B> /vicep</B><VAR>xx</VAR> を使用して完全区画名を指定します。ファイル・サーバー・マシン上のすべての区画をサルベージする場合には、このオプションを省略してください。
<P><DT><B>-volumeid
</B><DD>サルベージ対象である特定の読み取り / 書き込みボリュームのボリューム ID を指定します。この引き数と一緒に、<B>-partition</B> 引き数も指定します。
<P><DT><B>-debug
</B><DD><B>-parallel</B> オプションの設定に関係なく、
1 度に 1 つのサルベージャー・サブプロセスを実行します。デバッガーでサルベージャーを実行するときにこの引き数を指定すると、トレースの解釈が容易になります。
<P><DT><B>-nowrite
</B><DD>損傷したボリュームのサルベージを試みずに、未損傷のボリュームをすべてオンラインにします。
<P><DT><B>-inodes
</B><DD>サルベージャーが変更したすべての AFS i ノードのリストを <B>/usr/afs/logs/SalvageLog</B> ファイルに記録します。
<P><DT><B>-force
</B><DD>クラッシュ時にアクティブになっていたボリュームだけでなく、すべてのボリュームが壊れているとみなします。
<P><DT><B>-oktozap
</B><DD><B> vos zap</B> コマンドを <B>-force</B> フラグと発行した場合でも、無効となる損傷を受けたボリュームを削除します。この引き数は、AFS 開発または製品サポート担当者に相談してから使用してください。この引き数を <B>-partition</B> および <B>-volumeid</B> 引き数と発行して、削除するボリュームを識別します。
<P><DT><B>-rootinodes
</B><DD>サルベージャーが変更したすべての AFS i ノードのリストを <B>/usr/afs/logs/SalvageLog</B> ファイルに記録します。
<P><DT><B>-salvagedirs
</B><DD>損傷が明確でない場合でも、ディレクトリーの構造全体をサルベージします。デフォルトでは、サルベージャーは、破壊されているというフラグが立てられたディレクトリーのみをサルベージします。
<P><DT><B>-blockreads
</B><DD>サルベージャーは、1 度に 1 ディスク・ブロック (512 バイト) ずつ区画を読み取り、サルベージできないほど損傷のあるブロックはスキップします。これにより、可能なボリュームだけをサルベージすることができます。デフォルトでは、サルベージャーは、大きなディスク・ブロックを読み取るので、ディスク・エラーが検出されると、すぐに処理を終了します。サルベージする区画にディスク・エラーがある場合には、このフラグを使用してください。
<P><DT><B>-parallel
</B><DD>並列で実行するサルベージャー・サブプロセスの最大数を指定します。以下の 3 つの値のいずれかを指定してください。
<UL>
<LI><B>1</B> から <B>32</B> までの整数。
<B>1</B> を指定すると、単一のサルベージャー・プロセスが順次、区画をサルベージします。
</LI><LI>文字列 <B>all</B>。複数の物理ディスクにまたがる論理ボリュームとしてフォーマットされた区画上で、
4 つまでのサルベージャー・サブプロセスを並行して実行します。この値は、そのような論理ボリュームの場合にだけ使用してください。
</LI><LI>文字列 <B>all</B> と、その直後 (スペースを空けないで) に続く <B>1</B> から <B>32</B> までの範囲の整数。論理ボリュームとしてフォーマットされた区画上で、指定された数のサルベージャー・サブプロセスを実行します。この値は、そのような論理ボリュームの場合にだけ使用してください。
</LI></UL>
<P>
<P>
<P>BOS サーバーは、区画数以上のサルベージャー・サブプロセスを開始することはありません。単一ボリュームをサルベージする場合には、
1 つのプロセスしか開始しません。この引き数を省略すると、4 つまでのサルベージャー・サブプロセスが並行して実行されます。
<P><DT><B>-tmpdir
</B><DD>ローカル・ディスク・ディレクトリーに名前を付け、サルベージャーは、サルベージ操作中に作成する一時ファイルを、サルベージされる区画 (デフォルト) に書き込むのではなく、名前を付けたローカル・ディスク・ディレクトリーに格納します。サルベージャーは、指定されたディレクトリーに書き込めないと、サルベージされる区画に書き込もうとします。
<P><DT><B>-showlog
</B><DD>標準出力ストリームに <B>/usr/afs/logs/SalvageLog</B> ファイルへ書き込まれているログ・データすべてを表示します。
<P><DT><B>-showsuid
</B><DD>setuid または setgid モード・ビットが設定されたファイルすべてのパス名のリストを表示します。
<P><DT><B>-showmounts
</B><DD>各ボリュームで検出されるすべてのマウント・ポイントを <B>/usr/afs/logs/SalvageLog</B> ファイルに記録します。サルベージャーは、ボリューム内に破壊個所が存在していても修復しません。
<P><DT><B>-orphans
</B><DD>サルベージャーによるオーファン・ファイルおよびディレクトリーの処理方法を制御します。次の 3 つの値のいずれかを選択してください。
<P>
<DL>
<P><DT><B>ignore
</B><DD>オーファン・オブジェクトをディスクにそのまま残しておきます。ただし、検出されたオーファンの数と、それが占めているおおよそのキロバイト数を <B>/usr/afs/logs/SalvageLog</B> ファイルにメッセージを出力します。
<B>-orphans</B> 引き数が省略された場合は、この値がデフォルトになります。
<P><DT><B>remove
</B><DD>オーファン・オブジェクトを削除し、削除されたオーファンの数と、それが占めていたおおよそのディスク・サイズ (キロバイト) を報告する <B>/usr/afs/logs/SalvageLog</B> ファイルにメッセージを出力します。
<P><DT><B>attach
</B><DD>オーファン・オブジェクトへの参照を作成して、オーファン・オブジェクトをボリュームのルート・ディレクトリーの vnode に付加します。これにより各オブジェクトの実際の名前がなくなってしまうので、サルベージャーは各オブジェクトに次の形式の名前を割り当てます。
<P>
<DL>
<DD><P>ファイルの場合: <B>_ _ORPHANFILE_ _.</B><VAR>index</VAR>
<DD><P>ディレクトリーの場合: <B>_ _ORPHANDIR_ _.</B><VAR>index</VAR>
</DL>
<P>
<P>
<P>ここで、<VAR>index</VAR> は、各オブジェクトを一意に識別するための 2 桁の番号です。オーファンはボリューム割り当て量として数えられるので、ボリュームのルート・ディレクトリーに対して発行された <B>ls</B> コマンドの出力に表示されます。
</DL>
<P><DT><B>-help
</B><DD>このコマンドのオンライン・ヘルプを出力します。これ以外の有効なオプションはすべて無視されます。
</DL>
<P><STRONG>例</STRONG>
<P>次のコマンドでは、サルベージャーは、ローカル・マシンの <B>/vicepg</B> にあるボリューム ID 258347486 のボリュームをサルベージします。
<PRE>   % <B>/usr/afs/bin/salvager -partition /vicepg -volumeid 258347486</B>

</PRE>
<P><STRONG>必要となる特権</STRONG>
<P>シェル・プロンプトでコマンドを発行するには、発行側はローカル・スーパーユーザー <B>root</B> としてログインしている必要があります。
<P><STRONG>関連情報 </STRONG>
<P><A HREF="auarf016.htm#HDRBOSCONFIG">BosConfig</A>
<P><A HREF="auarf030.htm#HDRSALVAGELOG">SalvageLog</A>
<P><A HREF="auarf098.htm#HDRBOS_CREATE">bos create</A>
<P><A HREF="auarf102.htm#HDRBOS_GETLOG">bos getlog</A>
<P><A HREF="auarf114.htm#HDRBOS_SALVAGE">bos salvage</A>
<P><A HREF="auarf268.htm#HDRVOS_MOVE">vos move</A>
<P>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auarf231.htm">前ページ</A> &#124; <A HREF="auarf233.htm">次ページ</A> &#124; <A HREF="auarf002.htm#ToC">目次</A> &#124; <A HREF="auarf284.htm#HDRINDEX">索引</A> &#93;</B>
<!-- Begin Footer Records  ========================================== -->
<P><HR><B>
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved
</B>
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>

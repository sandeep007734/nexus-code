<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML 3//EN">
<HTML><HEAD>
<TITLE>管理解説書</TITLE>
<!-- Begin Header Records  ========================================== -->
<!-- C:\IDWB\TEMP\idwt1068\AUARF000.SCR converted by idb2h R4.2 (359) -->
<!-- ID Workbench Version (OS2) on 24 Dec 1999 at 21:46:04            -->
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=Shift_JIS">
<META HTTP-EQUIV="updated" CONTENT="Fri, 24 Dec 1999 21:46:02">
<META HTTP-EQUIV="review" CONTENT="Sun, 24 Dec 2000 21:46:02">
<META HTTP-EQUIV="expires" CONTENT="Mon, 24 Dec 2001 21:46:02">
</HEAD><BODY>
<!-- (C) IBM Corporation 2000. All Rights Reserved    -->
<BODY bgcolor="ffffff">
<!-- End Header Records  ============================================ -->
<A NAME="Top_Of_Page"></A>
<H1>管理解説書</H1>
<P>
<H2><A NAME="HDRCFG" HREF="auarf002.htm#ToC_16">CFG_<I>device_name</I></A></H2>
<P><STRONG>目的</STRONG>
<A NAME="IDX3900"></A>
<A NAME="IDX3901"></A>
<A NAME="IDX3902"></A>
<A NAME="IDX3903"></A>
<A NAME="IDX3904"></A>
<P>自動化された磁気テープ装置用の磁気テープ・コーディネーター構成命令を定義します。
<P><STRONG>構文</STRONG>
<P><B>CFG_</B><VAR>device_name</VAR> ファイルには、磁気テープ・スタッカー、ジュークボックスなど、自動バックアップ装置を使用するための磁気テープ・コーディネーターを構成する命令が記述されています。この命令によって、磁気テープ・コーディネーターはデータをローカル・ディスク装置上の<I>バックアップ・データ・ファイル</I> にダンプまたは復元することができ、バックアップ・プロセスの他の過程も自動化することができます。
<P>構成ファイルは、磁気テープ装置またはバックアップ・データ・ファイルごとに異なります。ファイル作成はオプションです。特定のタイプの磁気テープ装置に関する命令がファイル内にない場合は、ファイル作成は不要になります。
ASCII 形式のファイルが存在する場合は、このファイルは磁気テープ・コーディネーター・マシンの <B>/usr/afs/backup</B> ディレクトリーにあります。
<P><B>CFG_</B><VAR>device_name</VAR> ファイルは、
<B>/usr/afs/backup/tapeconfig</B> ファイルと置き換わりません。このファイルのコピーは、各磁気テ ープ・コーディネーター・マシンに存在していなければなりません。
<P>磁気テープ・コーディネーターで構成ファイルを検索できるようにするには、ファイル名の可変部分 <VAR>device_name</VAR> を次のように構成してください。
<UL>
<LI>磁気テープ装置の場合、装置名から最初の <B>/dev/</B> 文字列を削除し、名前の中のスラッシュを下線に置換してください。たとえば、<B>CFG_rmt_4m</B> は、
<B>/dev/rmt/4m</B> という名前のファイル名を表しています。
</LI><LI>バックアップ・データ・ファイルの場合、最初のスラッシュ (/) を削除し、名前の中の他のスラッシュを下線に置換してください。たとえば、<B>CFG_var_tmp_FILE</B> は、
<B>/var/tmp/FILE</B> という名前のバックアップ・データ・ファイルのファイル名です。
</LI></UL>
<P><B>CFG_</B><VAR>device_name</VAR> ファイルには、次の 1 つ以上の命令が 1 つの命令につき
1 行で記述されています。これらはすべてオプションで、任意の順序で表示されます。次のリストに、各命令の詳しい説明を示します。
<DL>
<P><DT><B>ASK
</B><DD>エラー条件の検出時に、磁気テープ・コーディネーターがガイダンスのプロンプトを出すかどうかを制御します。
<P><DT><B>AUTOQUERY
</B><DD>最初の磁気テープを要求するために、磁気テープ・コーディネーターがプロンプトを出すかどうかを制御します。
<P><DT><B>BUFFERSIZE
</B><DD>データ転送時に磁気テープ・コーディネーターが使用するメモリー・バッファーのサイズを設定します。
<P><DT><B>FILE
</B><DD>ダンプの書き込み先を磁気テープ装置またはファイルのいずれかに設定します。
<P><DT><B>MOUNT
</B><DD>装置ドライブに磁気テープを挿入するルーチンのあるファイルを指定します。
<P><DT><B>NAME_CHECK
</B><DD>磁気テープの AFS 磁気テープ名とダンプに書き込まれた内容が一致するかどうか、磁気テープ・コーディネーターが検査を行うかどうかを制御します。
<P><DT><B>UNMOUNT
</B><DD>装置ドライブから磁気テープを取り出すルーチンのあるファイルを指定します。
</DL>
<A NAME="IDX3905"></A>
<P><B>ASK 命令</B>
<P><B>ASK</B> 命令は、引き数としてブール値を必要とします。形式は次のとおりです。
<PRE>   ASK {<B>YES</B> | <B>NO</B>}

</PRE>
<P>値が <B>YES</B> の場合、磁気テープ・コーディネーターは次のリストにあるエラーに対する応答を要求するために、ウィンドウにプロンプトを表示します。
ASK 命令が <B>CFG_</B><VAR>device_name</VAR> ファイルにない場合、これがデフォルトの振る舞いになります。
<P>値が <B>NO</B> の場合、磁気テープ・コーディネーターはエラー検出時のプロンプトを出さずに、次のリストにあるデフォルトの自動応答を使用します。磁気テープ・コーディネーターは、エラーのログを <B>TE_</B><VAR>device_name</VAR> ファイルに記録します。
<B>MOUNT</B> 命令が使用されていない限り、テープを挿入を促すプロンプトが出ますが、プロンプトを抑制すると、無人で磁気テープ・コーディネーターを実行できるようになります。
<P>この命令で制御されるエラーは、次のとおりです。
<UL>
<LI><B>backup dump</B> コマンドの実行中、バックアップ・システムはボリュームのダンプを使用できません。
<B>YES</B> 値の場合には、磁気テープ・コーディネーターは 3 つの選択肢をプロンプトに表示します。表示される選択肢は、ボリュームの再ダンプを即時に試行する、ダンプからボリュームを省略するが操作は続行する、あるいは操作を終了させる、の 3 つです。
<B>NO</B> 値の場合には、磁気テープ・コーディネーターはダンプからボリュームを省略して操作を続行します。
</LI><LI><B>backup diskrestore</B>、
<B>backup volrestore</B>、または
<B>backup volsetrestore</B> コマンドの実行中、バックアップ・システムはボリュームの復元を使用できません。
<B>YES</B> 値の場合、磁気テープ・コーディネーターは、ボリュームを省略して他のボリュームの復元を続行する、操作を終了する、の 2 つの選択肢がプロンプトに表示されます。
<B>NO</B> 値の場合、問題のあるボリュームを省略しますが、それ以外のボリュームの復元操作を継続します。この場合、プロンプトは表示されません。
</LI><LI><B>backup scantape</B> コマンドの実行中、バックアップ・システムは、ダンプ・セットが複数の磁気テープに書き込まれているかどうか判別できません。
(この問題の原因については、このコマンドの解説ページを参照してください。)
<B>YES</B> 値の場合、磁気テープ・コーディネーターは、プロンプトを出して、走査する磁気テープが複数あるかどうか確認します。
<B>NO</B> 値の場合、複数の磁気テープがあることを前提に処理を進めて、構成ファイルの <B>MOUNT</B> 命令に指定されたルーチンを起動するか、プロンプトを出して、操作員に次の磁気テープの挿入を要求します。
</LI><LI>バックアップ・システムは、<B>backup labeltape</B> コマンドの実行中に、磁気テープに有効期限切れのダンプがないかどうか判別します。
<B>YES</B> の場合、磁気テープ・コーディネーターは、プロンプトを出して、処理を継続するのか、ラベル作成操作を終了するのかを確認します。
<B>NO</B> の場合には、操作を終了し、磁気テープのラベルは再作成しません。
</LI></UL>
<A NAME="IDX3906"></A>
<P><B>AUTOQUERY 命令</B>
<P><B>AUTOQUERY</B> 命令は、引き数として次の形式のブール値を必要とします。
<PRE>   AUTOQUERY {<B>YES</B> | <B>NO</B>}

</PRE>
<P>値が <B>YES</B> の場合、操作で最初の磁気テープが必要になると、磁気テープ ・コーディネーターは、構成ファイルの <B>MOUNT</B> 命令を検査します。前述のように、磁気テープ・コーディネーターは、プロンプトを出して磁気テープを要求するか、指定されたルーチンを起動して、磁気テープをマウントします。構成ファイルに <B>AUTOQUERY</B> 命令がない場合には、これがデフォルトの振る舞いになります。
<P>値が <B>NO</B> の場合、磁気テープ・コーディネーターは、操作の最初に必要な磁気テープが装置にあるとみなして、処理を継続します。この場合、最初の磁気テープへのアクセスにエラーがない限り、操作員にプロンプトを出したり、
<B>MOUNT</B> ルーチンを呼び出すことはしません。この設定は、
<B>butc</B> コマンドに <B>-noautoquery</B> フラグを指定した場合と同じに結果になります。
<P><B>AUTOQUERY</B> 命令の設定によって変わるのは、磁気テープ・コーディネーターが操作で最初に必要な磁気テープを要求するかどうかです。後続の磁気テープの場合には、磁気テープ・コーディネーターは、
<B>MOUNT</B> 命令を必ず検査します。最初の磁気テープへのアクセス時にエラーが検出された場合も、磁気テープ・コーディネーターは <B>MOUNT</B> 命令を参照します。
<A NAME="IDX3907"></A>
<P><B>BUFFERSIZE 命令</B>
<P><B>BUFFERSIZE</B> 命令は、引き数として次の形式の整数値を必要とします。
<PRE>   BUFFERSIZE <VAR>size</VAR>[{<B>k</B> | <B>K</B> | <B>m</B> | <B>M</B> | <B>g</B> | <B>G</B>}]

</PRE>
<P><VAR>size</VAR> には、ダンプおよび復元操作時にバッファーとして磁気テープ・コーディネーターが使用するメモリーの量を指定します。デフォルトはバイト単位ですが、KB 単位で指定する場合には
<B>k</B> または <B> K</B> を、
MB 単位で指定する場合には <B>m</B> または <B> M</B> を、
GB 単位で指定する場合には、
<B>g</B> または <B>G</B> を使用してください。
<VAR>size</VAR> に指定する値と単位の間にスペースは不要です。
<P>デフォルトでは、磁気テープ・コーディネーターは、ダンプ操作で 16 KB のバッファーを使用します。ボリューム・サーバーからボリューム・データを受信するときに、磁気テープ・コーディネーターは、
16 KB のデータをバッファーに収集してから、
16 KB すべてを磁気テープ装置またはバックアップ・データ・ファイルに転送します。同様に復元操作では、磁気テープ・コーディネーターは、デフォルトで 32 KB のデータを磁気テープ装置またはバックアップ・データ・ファイルからバッファーに入れてから、
32 KB すべてのボリューム・サーバーに転送し、ファイル・システムに復元します。バッファリングによってボリューム・データの流れが均一になり、磁気テープをストリームかすることができます。これにより、磁気テープ装置を効率よく操作することができます。
<P>通常のネットワーク構成では、デフォルトのバッファー・サイズで、磁気テープのストリーム化を行うことができます。磁気テープ・コーディネーター・マシンおよびファイル・サーバー・マシン間のネットワークが遅い場合には、バッファー・サイズを増加してください。
<A NAME="IDX3908"></A>
<P><B>FILE 命令</B>
<P><B>FILE</B> 命令は、引き数として次の形式のブール値を必要とします。
<PRE>   FILE {<B>NO</B> | <B>YES</B>}

</PRE>
<P>値が <B>NO</B> の場合、磁気テープ・コーディネーターは、ダンプ操作では磁気テープ装置に書き込みを、復元操作では磁気テープ装置から読み取りを行います。
<B>FILE</B> 命令が構成ファイルにない場合、これがデフォルトの振る舞いになります。
<P>値が <B>YES</B> の場合、磁気テープ・コーディネーターは、ダンプ操作ではボリューム・データをローカル・ディスクのバックアップ・データ ・ファイルに書き込み、復元操作ではそのファイルからボリューム・データを読み取ります。磁気テープ・コーディネーターは、ダンプを書き込むファイルが存在しないと、ファイルを作成します。復元操作を完了するには、このファイルが存在して、
<B>backup dump</B> 操作で以前にボリューム・データが書き込まれている必要があります。
<P>値が <B>YES</B> の場合、ローカルの <B>/usr/afs/backup/tapeconfig</B> ファイルにある対応するポート・オフセット項目の 3 番目のフィールドに、磁気テープ装置の名前ではなく、バックアップ・データ・ファイルの完全なパス名がなければなりません。このフィールドに磁気テープ装置が指定されていると、ダンプ操作は成功したようにみえますが、操作不能になります。
<B>FILE</B> 命令が <B>YES</B> に設定されている場合、磁気テープに装置に間違ってダンプされたデータは復元することができません。
(同様に、<B>FILE</B> 命令が <B>NO</B> に設定されている場合には、<B>tapeconfig</B> 項目に実際の磁気テープ装置が指定されていなければなりません。)
<P><B>tapeconfig</B> ファイルの 3 番目のフィールドに実際のファイルのパス名を指定しない場合には、<B>/dev</B> ディレクトリーに実際のファイルのパス名を指すシンボリック・リンクを作成し、そのシンボリック・リンクをこのフィールドに指定してください。この構成には、いくつかの利点があります。
<UL>
<LI><VAR>CFG_</VAR><B>device_name</B>、<VAR>TE_</VAR><B>device_name</B>、および <VAR>TL_</VAR><B>device_name</B> の <VAR>device_name</VAR> 部分を可能な限り短くすることができます。シンボリック・リンクは、あたかもそれが磁気テープ装置であるかのように <B>/dev</B> ディレクトリーにあるので、装置構成ファイルの名前は、最初のスラッシュではなく、<B>/dev/</B> 接頭部全体が削除されています。たとえば、シンボリック・リンクが <B>/dev/FILE</B> の場合、装置構成ファイルの名前は <B>CFG_FILE</B> になります。
<B>tapeconfig</B> ファイルに実際のパス名 <B>/var/tmp/FILE</B> がある場合には、ファイルの名前は <B>CFG_var_tmp_FILE</B> でなければなりません。
</LI><LI>磁気テープ・コーディネーターがバックアップ・データ・ファイルに完全なダンプを書き込めなくなった場合 (たとえば、バックアップ・データを保管している区画がいっぱいになった場合) でも、スマートに、おそらくは自動的に回復が行われます。この問題が起きると、磁気テープ・コーディネーターは <B>MOUNT</B> スクリプトを起動するか、構成ファイルに <B>MOUNT</B> 命令がない場合には操作員にプロンプトを出します。
<UL>
<LI><B>MOUNT</B> ルーチンがある場合、操作員は、スペースが利用可能な区画にある別のバックアップ・データ・ファイルを指すようにシンボリック・リンクを変更するサブルーチンを追加すると、この状況に対応することができます。
</LI><LI><B>MOUNT</B> 命令がない場合には、プロンプトによって、操作員は、別のバッ クアップ・データ・ファイルを指すように記号リンクを手操作で変更することができます。変更後、&lt;<B>Return</B>> を押すと、磁気テープ・コーディネーターは操作を継続します。
</LI></UL>
</LI></UL>
<P><B>tapeconfig</B> ファイルの 3 番目のフィールドに実際のファイル名が指定されている場合は、バックアップ・データ・ファイルのある区画にスペースがなくなると、回復することができません。操作の途中で、<B>tapeconfig</B> ファイルを変更することはできません。
<P>バックアップ・データ・ファイルの書き込み時に、磁気テープ・コーディネーターは、16 KB オフセットでデータを書き込みます。特定のデータ・ブロック (ボリュームの開始または終了を通知するマーカーなど) が 16 KB に満たない場合、磁気テープ・コーディネーターは、次のオフセットまでスキップし、次のブロックの書き込みを開始します。
<B>-id</B> オプションを付けて <B>backup dumpinfo</B> コマンドを発行すると、出力の <TT>Pos</TT> 列にボリューム・データが始まる 16-KB オフセットの位置が表示されます。磁気テープにダンプされる場合、この値は、前の行の位置番号に 1 を加えた値にはなりません。
<A NAME="IDX3909"></A>
<P><B>MOUNT 命令</B>
<P><B>MOUNT</B> 命令は、引き数として次の形式のパス名を必要とします。
<PRE>
   MOUNT <VAR>filename</VAR>

</PRE>
<P>指定される実行可能ファイルは、ローカル・ディスク上にあり、ジュークボックスやスタッカーなどの自動磁気テープ装置のマウント (磁気テープ読取装置への挿入) を指示するシェル・スクリプトまたはプログラムが記述されていなければなりません。操作員は、装置の製造元が指定するマウント・コマンドを呼び出すためのルーチンを作成しなければなりません。
AFS には、このようなスクリプトは用意されていませんが、次の「<B>例</B>」セクションにその例があります。このスクリプトまたはプログラムは、磁気テープ・コーディネーターの AFS 認証状況を継承しています。
<P>磁気テープ・コーディネーターは、磁気テープのマウントが必要になると、構成ファイルに <B>MOUNT</B> 命令があるかどうか検査します。<B>MOUNT</B> 命令がないと、磁気テープ・コーディネーターは、磁気テープ装置をオープンする前に操作員にプロンプトを出し、磁気テープの挿入を要求します。
<B>MOUNT</B> 命令がある場合には、磁気テープ・コーディネーターは、指定されたファイルのルーチンを実行します。
<B>MOUNT</B> 命令で呼び出されたルーチンは、<B>butc</B>コマンドの発行元のローカル ID (UNIX UID) と AFS トークンを継承します。
<P>ただし、例外もあります。<B>AUTOQUERY NO</B> 命令が構成ファイルがあるか、
<B> -noautoquery</B> フラグが <B>butc</B> コマンドに指定されていると、磁気テープ・コーディネーターは、操作に必要な最初の磁気テープが挿入されているとみなします。磁気テープ・コーディネーターは、磁気テープをすぐに読み取り、
<B>MOUNT</B> 命令があるかどうか検査するか、操作員にプロンプトを出し、磁気テープがないか必要な磁気テープでないことを通知します。
<P>磁気テープ・コーディネーターは、<B>MOUNT</B> 命令に指定されたルーチンを呼び出すときに、指定された順序で次のパラメーターをルーチンに渡します。
<OL TYPE=1>
<LI><B>/usr/afs/backup/tapeconfig</B> ファイルには、磁気テープ装置またはバックアップ・データ・ファイルのパス名が記録されています。
</LI><LI>磁気テープ操作。これは、(次に示す例外に当てはまる場合を除いて)
操作の開始に使用された <B>backup</B> コマンドの操作コードと一致します。
<UL>
<LI><B>appenddump</B> (<B>backup
dump</B> コマンドに <B>-append</B> フラグがある場合)
</LI><LI><B>dump</B> (<B>backup dump</B> コマンドが <B>-append</B> フラグを含まない場合)
</LI><LI><B>labeltape</B>
</LI><LI><B>readlabel</B>
</LI><LI><B>restore</B> (<B>backup
diskrestore</B>、<B>backup volrestore</B>、または
<B>backup volsetrestore</B> コマンドに対して)
</LI><LI><B>restoredb</B>
</LI><LI><B>savedb</B>
</LI><LI><B>scantape</B>
</LI></UL>
</LI><LI>磁気テープ・コーディネーターが磁気テープ装置またはバックアップ・データ・ファイルをオープンしようとした回数。オープン試行でエラーが戻されると、磁気テープ・コーディネーターは値を増やして、再度 <B>MOUNT</B> 命令を呼び出します。
</LI><LI>磁気テープの名前。操作によっては、磁気テープ・コーディネーターは、磁気テープ名を識別できない場合 (たとえば、<B> backup scantape</B>
または <B>backup readlabel</B> を実行している場合)、あるいは磁気テープに必要な名前がない場合 (たとえば、
<B>backup labeltape</B> コマンドを実行している場合) に、
<TT> none</TT> という文字列を渡します。
</LI><LI>バックアップ・データベースに記録されている磁気テープ ID。磁気テープ名と同様に、バックアップ・システムは、磁気テープ ID が識別できない場合または必要な ID がない場合に、操作に対して <TT>none</TT> という文字列を渡します。
</LI></OL>
<P><B>MOUNT</B> 命令で呼び出されたルーチンは、磁気テープ・コーディネーターに終了コードを戻さなければなりません。
<UL>
<LI>コード <B>0</B> (ゼロ) は、ルーチンが正しく磁気テープをマウントしたことを示します。磁気テープ・コーディネーターは、バックアップ操作を継続します。
<B>MOUNT</B> 命令が呼び出したルーチンからこの終了コードを受信しないと、磁気テープ・コーディネーターは、<B>UNMOUNT</B> 命令を呼び出すことができません。
</LI><LI>コード <B>1</B> (1) は、このルーチンが磁気テープのマウントに失敗したことを示します。磁気テープ・コーディネーターは、操作を終了します。
</LI><LI>これ以外のコードは、ルーチンが正しい磁気テープにアクセスできなかったことを示しています。磁気テープ・コーディネーターは、操作員にプロンプトを出し、正しい磁気テープを挿入するように要求します。
</LI></UL>
<P><B>backup</B> コマンドが対話モードで発行され、
<B>MOUNT</B> ルーチンの実行中に、操作員が <B>(backup) kill</B> コマンドを発行すると、磁気テープ・コーディネーターはそのルーチンに終了信号を送信し、操作全体を終了します。
<A NAME="IDX3910"></A>
<P><B>NAME_CHECK 命令</B>
<P><B>NAME_CHECK</B> 命令は、引き数として次の形式のブール値を必要とします。
<PRE>   NAME_CHECK {<B>YES</B> | <B>NO</B>}

</PRE>
<P>値が <B>YES</B> で、磁気テープに永続名がない場合、磁気テープ・コーディネーターは、<B>backup dump</B> コマンドに応答してボリュームをダンプするときに、AFS 磁気テープ名を検査します。
AFS 磁気テープ名は <TT>&lt;NULL&gt;</TT> か、またはボリューム・セットおよびダンプ・レベル名に基づき <B>backup dump</B> 操作によって割り当てられた磁気テープ名と一致していなければなりません。
<B>NAME_CHECK</B> 命令が構成ファイルにない場合には、これがデフォルトの振る舞いになります。
<P>値が <B>NO</B> の場合には、磁気テープ・コーディネーターは、AFS 磁気テープ名を検査せずに、磁気テープに書き込みを開始します。
<P>磁気テープ・コーディネーターは常に、磁気テープのすべてのダンプが有効期限切れになっているかどうか検査し、期限切れになっていないダンプがある磁気テープには書き込みを行いません。
<A NAME="IDX3911"></A>
<P><B>UNMOUNT 命令</B>
<P><B>UNMOUNT</B> 命令は、引き数として次の形式のパス名を必要とします。
<PRE>   UNMOUNT <VAR>filename</VAR>

</PRE>
<P>指定される実行可能ファイルは、ローカル・ディスク上にあり、ジュークボックスやスタッカーなどの自動磁気テープ装置のアンマウント (磁気テープ読取装置からの取り外し) を指示するシェル・スクリプトまたはプログラムが記述されていなければなりません。操作員は、装置の製造元が指定するアンマウント・コマンドを呼び出すためのルーチンを作成しなければなりません。AFS には、このようなスクリプトは用意されていませんが、次の「<B>例</B>」セクションにその例があります。このスクリプトまたはプログラムは、磁気テープ・コーディネーターの AFS 認証状況を継承しています。
<P>磁気テープ装置をクローズした後で、磁気テープ・コーディネーターは、構成ファイルに <B>UNMOUNT</B> 命令があるかどうか検査します。この検査は、<B>クローズ</B>操作が成功したかどうかに関係なく行われます。<B> UNMOUNT</B> 命令がないと、磁気テープ・コーディネーターはアクションを実行しません。この場合、操作員が、次のテープを挿入する前に装置から磁気テープを取り外す必要があります。
<B> UNMOUNT</B> 命令があると、磁気テープ・コーディネーターは、指定されたファイルを実行します。ルーチンを 1 回だけ呼び出し、次のパラメーターを渡します。
<UL>
<LI>磁気テープ装置のパス名 (<B>/usr/afs/backup/tapeconfig</B> ファイルに指定されています)
</LI><LI>磁気テープ操作 (常に <B>unmount</B>)
</LI></UL>
<P><STRONG>必要となる特権</STRONG>
<P>ファイルは UNIX のモード・ビットにより保護されています。ファイルを作成するには、<B>/usr/afs/backup</B> ディレクトリーに対する <B>w</B> (<B>書き込み</B>) および
<B>x</B> (<B>実行</B>) アクセス権が必要です。ファイルを編集するには、ファイルに対する
<B>w</B> (<B>書き込み</B>) アクセス権が必要です。
<P><STRONG>例</STRONG>
<P>次の構成ファイルの例では、スタッカーあるいはバックアップ・ダンプ・ファイルの構成ファイルを作成するための方法が示されています。セルによっては、この例は適切でない場合があります。この例をモデルとして使用する場合には、セルの要件に合わせて修正してください。
<P><B>例</B> <B>CFG_</B><VAR>device_name</VAR> <B>スタッカー用のファイル</B>
<P>この例では、管理者は、次に示している <B>stacker0.1</B> という磁気テープ・スタッカーのための項目を、<B>/usr/afs/backup/tapeconfig</B> ファイルに作成しています。この項目には、ポート・オフセット 0 があります。
<PRE>   2G   5K   /dev/stacker0.1   0

</PRE>
<P>管理者は <B>/usr/afs/backup/CFG_stacker0.1</B> ファイルに、次に示した 5 行を記述しています。各命令の意味を知るには、前述の「<B>解説</B>」セクションを参照してください。
<PRE>   MOUNT /usr/afs/backup/stacker0.1
   UNMOUNT /usr/afs/backup/stacker0.1
   AUTOQUERY NO
   ASK NO
   NAME_CHECK NO

</PRE>
<P>最後に、管理者は、<B>CFG_stacker0.1</B> ファイルの <B>MOUNT</B> および <B>UNMOUNT</B> 命令で参照される以下の実行可能なルーチンを <B>/usr/afs/backup/stacker0.1</B> ファイルに作成しています。
<PRE>   #! /bin/csh -f

   set devicefile = $1
   set operation = $2
   set tries = $3
   set tapename = $4
   set tapeid = $5

   set exit_continue = 0
   set exit_abort = 1
   set exit_interactive = 2

   #--------------------------------------------

   if (${tries} > 1) then
      echo "Too many tries"
      exit ${exit_interactive}
   endif

   if (${operation} == "unmount") then
      echo "UnMount: Will leave tape in drive"
      exit ${exit_continue}
   endif

   if ((${operation} == "dump")     |\
       (${operation} == "appenddump")     |\
       (${operation} == "savedb"))  then

       stackerCmd_NextTape ${devicefile}
       if (${status} != 0)exit${exit_interactive}
       echo "Will continue"
       exit ${exit_continue}
   endif

   if ((${operation} == "labeltape")    |\
       (${operation} == "readlabel")) then
      echo "Will continue"
      exit ${exit_continue}
   endif

   echo "Prompt for tape"
   exit ${exit_interactive}

</PRE>
<P>このルーチンは、バックアップ・システムから渡される <TT>tries</TT> と <TT>operation</TT> という 2 つのパラメーターを使用しています。
<TT>tries</TT> パラメーターの値が 1 を超えた場合は、このルーチンは推奨された方法で磁気テープに関するプロンプトを出します。このパラメーターの値が 1 を超えると、スタッカーに磁気テープがないということを意味します。
<P><B>backup dump</B> または <B>backup savedb</B> 操作の場合は、このルーチンはスタッカーの製造元が提供するサンプルの <B>stackerCmd_NextTape</B> 関数を呼び出します。ファイルの最終行は、操作員に対してテープの挿入のためのプロンプトを出す終了コードを戻すことに注意してください。これらの行は、スタッカーが磁気テープをロードできないか、実行されている操作がファイルで明示的に記述されている操作 (たとえば回復操作) でない場合に呼び出されます。
<P><B>バックアップ・データ・ファイルへのダンプのための CFG_</B><VAR>device_name</VAR><B> ファイルの例</B>
<P>この例では、管理者は、次に示す <B>HSM_device</B> と呼ばれるバックアップ・データ・ファイルのための項目を、<B>/usr/afs/backup/tapeconfig</B> ファイルに作成しています。この項目には、ポート・オフセット 20 があります。
<PRE>   1G   0K   /dev/HSM_device   20

</PRE>
<P>管理者は <B>/usr/afs/backup/CFG_HSM_device</B> ファイルに、次に示した行を記述しています。各命令の意味を知るには、前述の「<B>解説</B>」セクションを参照してください。
<PRE>   MOUNT /usr/afs/backup/file
   FILE YES
   ASK NO

</PRE>
<P>最後に、管理者は、<B>CFG_HSM_device</B> ファイルの <B>MOUNT</B> 命令で参照される実行可能なルーチンを <B>/usr/afs/backup/file</B> ファイルに作成しています。
<PRE>   #! /bin/csh -f
   set devicefile = $1
   set operation = $2
   set tries = $3
   set tapename = $4
   set tapeid = $5

   set exit_continue = 0
   set exit_abort = 1
   set exit_interactive = 2

   #--------------------------------------------

   if (${tries} > 1) then
      echo "Too many tries"
      exit ${exit_interactive}
   endif

   if (${operation} == "labeltape") then
      echo "Won't label a tape/file"
      exit ${exit_abort}
   endif

   if ((${operation} == "dump")   |\
       (${operation} == "appenddump")   |\
       (${operation} == "restore")   |\
       (${operation} == "savedb")    |\
       (${operation} == "restoredb")) then

      /bin/rm -f ${devicefile}
      /bin/ln -s /hsm/${tapename}_${tapeid} ${devicefile}
      if (${status} != 0) exit ${exit_abort}
   endif

   exit ${exit_continue}

</PRE>
<P>磁気テープ・スタッカーのルーチンの例と同様、このルーチンもバックアップ・システムから渡される <TT>tries</TT> と <TT>operation</TT> パラメーターを使用します。
<TT>tries</TT> パラメーターは、磁気テープ・コーディネーターがファイルにアクセスしようとした回数を追跡します。値が 1 を超えていると、磁気テープ・コーディネーターはファイルにアクセスできないことを示し、このルーチンは終了コード 2 (<TT>exit_interactive</TT>) を戻します。この場合、操作員に対して磁気テープをロードするようにプロンプトが出されます。この場合に、操作員は <B>tapeconfig</B> ファイルに指定されているバックアップ・データ・ファイルの名前を変更することができます。
<P>このルーチンの基本的な機能は、ダンプまたは復元されるファイルと装置ファイルとのリンクを確立させることにあります。磁気テープ・コーディネーターが <B>backup dump</B>、
<B>backup restore</B>、<B>backup savedb</B>、または <B>backup restoredb</B> 操作を実行している場合、このルーチンは UNIX の <B>ln -s</B> コマンドを呼び出し、
<B>tapeconfig</B> ファイルで指定されているバックアップ・データ・ファイルから実際に使用するファイルへのリンクを作成します
(これが推奨方法です)。ファイル名を構成する場合、磁気テープ・コーディネーターは <TT>tapename</TT> と <TT>tapeid</TT> パラメーターを使用します。
<P><STRONG>関連情報 </STRONG>
<P><A HREF="auarf050.htm#HDRTAPECONFIG">tapeconfig</A>
<P><A HREF="auarf072.htm#HDRBK_DISKRESTORE">backup diskrestore</A>
<P><A HREF="auarf073.htm#HDRBK_DUMP">backup dump</A>
<P><A HREF="auarf085.htm#HDRBK_RESTOREDB">backup restoredb</A>
<P><A HREF="auarf086.htm#HDRBK_SAVEDB">backup savedb</A>
<P><A HREF="auarf091.htm#HDRBK_VOLRESTORE">backup volrestore</A>
<P><A HREF="auarf092.htm#HDRBK_VOLSETRESTORE">backup volsetrestore</A>
<P>
<P><HR><B>&#91; <A HREF="#Top_Of_Page">ページのトップ</A> &#124; <A HREF="auarf017.htm">前ページ</A> &#124; <A HREF="auarf019.htm">次ページ</A> &#124; <A HREF="auarf002.htm#ToC">目次</A> &#124; <A HREF="auarf284.htm#HDRINDEX">索引</A> &#93;</B>
<!-- Begin Footer Records  ========================================== -->
<P><HR><B>
<br>(C) <A HREF="http://www.ibm.com/">IBM Corporation 2000.</A>  All Rights Reserved
</B>
<!-- End Footer Records  ============================================ -->
<A NAME="Bot_Of_Page"></A>
</BODY></HTML>
